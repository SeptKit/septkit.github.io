import{H as xn,b as ot,f as Yt,g as Qo,n as po,p as Jo,q as Zo,l as Sn,s as At,t as ea,m as ta,I as na,x as Tn,y as vt,u as ra,J as oa,K as ho,d as aa,z as ia,c as sa,a as ua,o as ca,L as la}from"./index-BxIMvYka.js";const fa=(c,p)=>{const g=c.__vccOpts||c;for(const[d,I]of p)g[d]=I;return g},Nn=xn("extension",()=>{const c=ot(null),p=ot([]),g=ot();return{extensions:p,setExtensions:k,activeExtensionId:c,setActiveExtension:d,clearActiveExtension:I,unmountExtension:g};function d(B){c.value=B}function I(){c.value=null}function k(B){p.value=B}}),Ri=mo("mainArea"),Mi=mo("primarySidebar"),Ki=xn("menuContributionStore",()=>{const c=Nn();return{contributions:Yt(()=>c.extensions.map(g=>g.contributions.filter(d=>d.type==="menu").map(d=>d)).flat())}});function mo(c){return xn(`${c}Store`,()=>{const p=Nn(),g=ot();return{widgets:Yt(()=>p.extensions.map(k=>k.contributions.filter(B=>B.type==="widget"&&B.location===c).map(B=>B)).flat()),get activeWidget(){return g},activateWidget:I};function I(k){g.value=k}})}function yo(c,p){const g=new URL(p),d=c.replace("/",""),I=g.pathname.split("/").filter(Boolean);return I.push(d),I.unshift(g.origin),I.join("/")}async function qi(c){const p=Nn(),g=await pa(c);p.setExtensions(g)}async function pa(c){return(await Promise.allSettled(c.map(async g=>{const d=await ha(g);return{id:d.name,version:d.version,label:d.displayName,contributions:[...d.contributes.customEditors?.map(I=>Hr(I,g,"mainArea"))??[],...d.contributes.primarySidebars?.map(I=>Hr(I,g,"primarySidebar"))??[],...d.contributes.menu?.map(I=>da(I,g))??[]]}}).filter(Boolean))).filter(g=>g.status==="fulfilled").map(g=>g.value)}function Hr(c,p,g){const d=ma(c);return{id:c.id,type:"widget",label:c.displayName,icon:c.icon,location:g,startFnUrl:yo(c.entryPoint,p),iframe:d}}function da(c,p){return{id:c.id,type:"menu",label:c.displayName,icon:c.icon,menuPath:c.path??[],actionFnUrl:yo(c.entryPoint,p)}}async function ha(c){try{const p=new URL("package.json",c).toString(),g=await fetch(p);if(!g.ok)throw new Error(`Failed to fetch package.json from ${p}`);return await g.json()}catch(p){throw console.error("Error fetching package.json:",p),p}}function ma(c){let p=!1;return c.iframe!==void 0&&(p=c.iframe??!1),p}async function ya(c){const p=await import(c);if(!p.default)throw new Error(`Default export not found in the loaded module from ${c}`);return p.default}function yr(c){return Jo()?(Zo(c),!0):!1}function Qr(){const c=new Set,p=k=>{c.delete(k)};return{on:k=>{c.add(k);const B=()=>p(k);return yr(B),{off:B}},off:p,trigger:(...k)=>Promise.all(Array.from(c).map(B=>B(...k))),clear:()=>{c.clear()}}}const vo=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const va=Object.prototype.toString,ga=c=>va.call(c)==="[object Object]",go=()=>{},ba=(c,p)=>Object.prototype.hasOwnProperty.call(c,p);function wa(...c){if(c.length!==1)return ea(...c);const p=c[0];return typeof p=="function"?Sn(ta(()=>({get:p,set:go}))):ot(p)}function _a(c,p){function g(...d){return new Promise((I,k)=>{Promise.resolve(c(()=>p.apply(this,d),{fn:p,thisArg:this,args:d})).then(I).catch(k)})}return g}const bo=c=>c();function Ea(c=bo,p={}){const{initialState:g="active"}=p,d=wa(g==="active");function I(){d.value=!1}function k(){d.value=!0}const B=(...D)=>{d.value&&c(...D)};return{isActive:Sn(d),pause:I,resume:k,eventFilter:B}}function cr(c){return Array.isArray(c)?c:[c]}function Ta(c){return na()}function xa(c,p,g={}){const{eventFilter:d=bo,...I}=g;return At(c,_a(d,p),I)}function Sa(c,p,g={}){const{eventFilter:d,initialState:I="active",...k}=g,{eventFilter:B,pause:D,resume:Y,isActive:$}=Ea(d,{initialState:I});return{stop:xa(c,p,{...k,eventFilter:B}),pause:D,resume:Y,isActive:$}}function Na(c,p=!0,g){Ta()?Qo(c,g):p?c():po(c)}function Aa(c,p,g){return At(c,p,{...g,immediate:!0})}function ji(c,p,g){let d;oa(g)?d={evaluating:g}:d={};const{lazy:I=!1,flush:k="pre",evaluating:B=void 0,shallow:D=!0,onError:Y=go}=d,$=Tn(!I),ee=D?Tn(p):ot(p);let G=0;return ho(async de=>{if(!$.value)return;G++;const se=G;let K=!1;B&&Promise.resolve().then(()=>{B.value=!0});try{const C=await c(Q=>{de(()=>{B&&(B.value=!1),K||Q()})});se===G&&(ee.value=C)}catch(C){Y(C)}finally{B&&se===G&&(B.value=!1),K=!0}},{flush:k}),I?Yt(()=>($.value=!0,ee.value)):ee}const pr=vo?window:void 0,Oa=vo?window.document:void 0;function wo(c){var p;const g=vt(c);return(p=g?.$el)!=null?p:g}function Jr(...c){const p=[],g=()=>{p.forEach(D=>D()),p.length=0},d=(D,Y,$,ee)=>(D.addEventListener(Y,$,ee),()=>D.removeEventListener(Y,$,ee)),I=Yt(()=>{const D=cr(vt(c[0])).filter(Y=>Y!=null);return D.every(Y=>typeof Y!="string")?D:void 0}),k=Aa(()=>{var D,Y;return[(Y=(D=I.value)==null?void 0:D.map($=>wo($)))!=null?Y:[pr].filter($=>$!=null),cr(vt(I.value?c[1]:c[0])),cr(ra(I.value?c[2]:c[1])),vt(I.value?c[3]:c[2])]},([D,Y,$,ee])=>{if(g(),!D?.length||!Y?.length||!$?.length)return;const G=ga(ee)?{...ee}:ee;p.push(...D.flatMap(de=>Y.flatMap(se=>$.map(K=>d(de,se,K,G)))))},{flush:"post"}),B=()=>{k(),g()};return yr(g),B}const wn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_n="__vueuse_ssr_handlers__",Pa=Ia();function Ia(){return _n in wn||(wn[_n]=wn[_n]||{}),wn[_n]}function Ca(c,p){return Pa[c]||p}function ka(c){return c==null?"any":c instanceof Set?"set":c instanceof Map?"map":c instanceof Date?"date":typeof c=="boolean"?"boolean":typeof c=="string"?"string":typeof c=="object"?"object":Number.isNaN(c)?"any":"number"}const Da={boolean:{read:c=>c==="true",write:c=>String(c)},object:{read:c=>JSON.parse(c),write:c=>JSON.stringify(c)},number:{read:c=>Number.parseFloat(c),write:c=>String(c)},any:{read:c=>c,write:c=>String(c)},string:{read:c=>c,write:c=>String(c)},map:{read:c=>new Map(JSON.parse(c)),write:c=>JSON.stringify(Array.from(c.entries()))},set:{read:c=>new Set(JSON.parse(c)),write:c=>JSON.stringify(Array.from(c))},date:{read:c=>new Date(c),write:c=>c.toISOString()}},Zr="vueuse-storage";function eo(c,p,g,d={}){var I;const{flush:k="pre",deep:B=!0,listenToStorageChanges:D=!0,writeDefaults:Y=!0,mergeDefaults:$=!1,shallow:ee,window:G=pr,eventFilter:de,onError:se=ae=>{console.error(ae)},initOnMounted:K}=d,C=(ee?Tn:ot)(typeof p=="function"?p():p),Q=Yt(()=>vt(c));if(!g)try{g=Ca("getDefaultStorage",()=>{var ae;return(ae=pr)==null?void 0:ae.localStorage})()}catch(ae){se(ae)}if(!g)return C;const ne=vt(p),_e=ka(ne),z=(I=d.serializer)!=null?I:Da[_e],{pause:W,resume:oe}=Sa(C,()=>at(C.value),{flush:k,deep:B,eventFilter:de});At(Q,()=>fe(),{flush:k});let le=!1;const re=ae=>{K&&!le||fe(ae)},Oe=ae=>{K&&!le||De(ae)};G&&D&&(g instanceof Storage?Jr(G,"storage",re,{passive:!0}):Jr(G,Zr,Oe)),K?Na(()=>{le=!0,fe()}):fe();function N(ae,me){if(G){const Se={key:Q.value,oldValue:ae,newValue:me,storageArea:g};G.dispatchEvent(g instanceof Storage?new StorageEvent("storage",Se):new CustomEvent(Zr,{detail:Se}))}}function at(ae){try{const me=g.getItem(Q.value);if(ae==null)N(me,null),g.removeItem(Q.value);else{const Se=z.write(ae);me!==Se&&(g.setItem(Q.value,Se),N(me,Se))}}catch(me){se(me)}}function Le(ae){const me=ae?ae.newValue:g.getItem(Q.value);if(me==null)return Y&&ne!=null&&g.setItem(Q.value,z.write(ne)),ne;if(!ae&&$){const Se=z.read(me);return typeof $=="function"?$(Se,ne):_e==="object"&&!Array.isArray(Se)?{...ne,...Se}:Se}else return typeof me!="string"?me:z.read(me)}function fe(ae){if(!(ae&&ae.storageArea!==g)){if(ae&&ae.key==null){C.value=ne;return}if(!(ae&&ae.key!==Q.value)){W();try{ae?.newValue!==z.write(C.value)&&(C.value=Le(ae))}catch(me){se(me)}finally{ae?po(oe):oe()}}}}function De(ae){fe(ae.detail)}return C}const Fa={multiple:!0,accept:"*",reset:!1,directory:!1};function Ba(c){if(!c)return null;if(c instanceof FileList)return c;const p=new DataTransfer;for(const g of c)p.items.add(g);return p.files}function to(c={}){const{document:p=Oa}=c,g=ot(Ba(c.initialFiles)),{on:d,trigger:I}=Qr(),{on:k,trigger:B}=Qr();let D;p&&(D=wo(c.input)||p.createElement("input"),D.type="file",D.onchange=ee=>{const G=ee.target;g.value=G.files,I(g.value)},D.oncancel=()=>{B()});const Y=()=>{g.value=null,D&&D.value&&(D.value="",I(null))},$=ee=>{if(!D)return;const G={...Fa,...c,...ee};D.multiple=G.multiple,D.accept=G.accept,D.webkitdirectory=G.directory,ba(G,"capture")&&(D.capture=G.capture),G.reset&&Y(),D.click()};return{files:Sn(g),open:$,reset:Y,onCancel:k,onChange:d}}function Ra(c){const p=Tn(),g=()=>{p.value&&URL.revokeObjectURL(p.value),p.value=void 0};return At(()=>vt(c),d=>{g(),d&&(p.value=URL.createObjectURL(d))},{immediate:!0}),yr(g),Sn(p)}var Ma=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _o(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}function Ka(c){if(Object.prototype.hasOwnProperty.call(c,"__esModule"))return c;var p=c.default;if(typeof p=="function"){var g=function d(){var I=!1;try{I=this instanceof d}catch{}return I?Reflect.construct(p,arguments,this.constructor):p.apply(this,arguments)};g.prototype=p.prototype}else g={};return Object.defineProperty(g,"__esModule",{value:!0}),Object.keys(c).forEach(function(d){var I=Object.getOwnPropertyDescriptor(c,d);Object.defineProperty(g,d,I.get?I:{enumerable:!0,get:function(){return c[d]}})}),g}var no={};const qa={},ja=Object.freeze(Object.defineProperty({__proto__:null,default:qa},Symbol.toStringTag,{value:"Module"})),ro=Ka(ja);var oo;function La(){return oo||(oo=1,function(c){(function(p){p.parser=function(s,i){return new d(s,i)},p.SAXParser=d,p.SAXStream=ee,p.createStream=$,p.MAX_BUFFER_LENGTH=64*1024;var g=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];p.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function d(s,i){if(!(this instanceof d))return new d(s,i);var S=this;k(S),S.q=S.c="",S.bufferCheckPosition=p.MAX_BUFFER_LENGTH,S.opt=i||{},S.opt.lowercase=S.opt.lowercase||S.opt.lowercasetags,S.looseCase=S.opt.lowercase?"toLowerCase":"toUpperCase",S.tags=[],S.closed=S.closedRoot=S.sawRoot=!1,S.tag=S.error=null,S.strict=!!s,S.noscript=!!(s||S.opt.noscript),S.state=N.BEGIN,S.strictEntities=S.opt.strictEntities,S.ENTITIES=S.strictEntities?Object.create(p.XML_ENTITIES):Object.create(p.ENTITIES),S.attribList=[],S.opt.xmlns&&(S.ns=Object.create(C)),S.opt.unquotedAttributeValues===void 0&&(S.opt.unquotedAttributeValues=!s),S.trackPosition=S.opt.position!==!1,S.trackPosition&&(S.position=S.line=S.column=0),Le(S,"onready")}Object.create||(Object.create=function(s){function i(){}i.prototype=s;var S=new i;return S}),Object.keys||(Object.keys=function(s){var i=[];for(var S in s)s.hasOwnProperty(S)&&i.push(S);return i});function I(s){for(var i=Math.max(p.MAX_BUFFER_LENGTH,10),S=0,T=0,ue=g.length;T<ue;T++){var H=s[g[T]].length;if(H>i)switch(g[T]){case"textNode":De(s);break;case"cdata":fe(s,"oncdata",s.cdata),s.cdata="";break;case"script":fe(s,"onscript",s.script),s.script="";break;default:me(s,"Max buffer length exceeded: "+g[T])}S=Math.max(S,H)}var ye=p.MAX_BUFFER_LENGTH-S;s.bufferCheckPosition=ye+s.position}function k(s){for(var i=0,S=g.length;i<S;i++)s[g[i]]=""}function B(s){De(s),s.cdata!==""&&(fe(s,"oncdata",s.cdata),s.cdata=""),s.script!==""&&(fe(s,"onscript",s.script),s.script="")}d.prototype={end:function(){Se(this)},write:ze,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){B(this)}};var D;try{D=ro.Stream}catch{D=function(){}}D||(D=function(){});var Y=p.EVENTS.filter(function(s){return s!=="error"&&s!=="end"});function $(s,i){return new ee(s,i)}function ee(s,i){if(!(this instanceof ee))return new ee(s,i);D.apply(this),this._parser=new d(s,i),this.writable=!0,this.readable=!0;var S=this;this._parser.onend=function(){S.emit("end")},this._parser.onerror=function(T){S.emit("error",T),S._parser.error=null},this._decoder=null,Y.forEach(function(T){Object.defineProperty(S,"on"+T,{get:function(){return S._parser["on"+T]},set:function(ue){if(!ue)return S.removeAllListeners(T),S._parser["on"+T]=ue,ue;S.on(T,ue)},enumerable:!0,configurable:!1})})}ee.prototype=Object.create(D.prototype,{constructor:{value:ee}}),ee.prototype.write=function(s){if(typeof Buffer=="function"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(s)){if(!this._decoder){var i=ro.StringDecoder;this._decoder=new i("utf8")}s=this._decoder.write(s)}return this._parser.write(s.toString()),this.emit("data",s),!0},ee.prototype.end=function(s){return s&&s.length&&this.write(s),this._parser.end(),!0},ee.prototype.on=function(s,i){var S=this;return!S._parser["on"+s]&&Y.indexOf(s)!==-1&&(S._parser["on"+s]=function(){var T=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);T.splice(0,0,s),S.emit.apply(S,T)}),D.prototype.on.call(S,s,i)};var G="[CDATA[",de="DOCTYPE",se="http://www.w3.org/XML/1998/namespace",K="http://www.w3.org/2000/xmlns/",C={xml:se,xmlns:K},Q=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,ne=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,_e=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,z=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function W(s){return s===" "||s===`
`||s==="\r"||s==="	"}function oe(s){return s==='"'||s==="'"}function le(s){return s===">"||W(s)}function re(s,i){return s.test(i)}function Oe(s,i){return!re(s,i)}var N=0;p.STATE={BEGIN:N++,BEGIN_WHITESPACE:N++,TEXT:N++,TEXT_ENTITY:N++,OPEN_WAKA:N++,SGML_DECL:N++,SGML_DECL_QUOTED:N++,DOCTYPE:N++,DOCTYPE_QUOTED:N++,DOCTYPE_DTD:N++,DOCTYPE_DTD_QUOTED:N++,COMMENT_STARTING:N++,COMMENT:N++,COMMENT_ENDING:N++,COMMENT_ENDED:N++,CDATA:N++,CDATA_ENDING:N++,CDATA_ENDING_2:N++,PROC_INST:N++,PROC_INST_BODY:N++,PROC_INST_ENDING:N++,OPEN_TAG:N++,OPEN_TAG_SLASH:N++,ATTRIB:N++,ATTRIB_NAME:N++,ATTRIB_NAME_SAW_WHITE:N++,ATTRIB_VALUE:N++,ATTRIB_VALUE_QUOTED:N++,ATTRIB_VALUE_CLOSED:N++,ATTRIB_VALUE_UNQUOTED:N++,ATTRIB_VALUE_ENTITY_Q:N++,ATTRIB_VALUE_ENTITY_U:N++,CLOSE_TAG:N++,CLOSE_TAG_SAW_WHITE:N++,SCRIPT:N++,SCRIPT_ENDING:N++},p.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},p.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(p.ENTITIES).forEach(function(s){var i=p.ENTITIES[s],S=typeof i=="number"?String.fromCharCode(i):i;p.ENTITIES[s]=S});for(var at in p.STATE)p.STATE[p.STATE[at]]=at;N=p.STATE;function Le(s,i,S){s[i]&&s[i](S)}function fe(s,i,S){s.textNode&&De(s),Le(s,i,S)}function De(s){s.textNode=ae(s.opt,s.textNode),s.textNode&&Le(s,"ontext",s.textNode),s.textNode=""}function ae(s,i){return s.trim&&(i=i.trim()),s.normalize&&(i=i.replace(/\s+/g," ")),i}function me(s,i){return De(s),s.trackPosition&&(i+=`
Line: `+s.line+`
Column: `+s.column+`
Char: `+s.c),i=new Error(i),s.error=i,Le(s,"onerror",i),s}function Se(s){return s.sawRoot&&!s.closedRoot&&he(s,"Unclosed root tag"),s.state!==N.BEGIN&&s.state!==N.BEGIN_WHITESPACE&&s.state!==N.TEXT&&me(s,"Unexpected end"),De(s),s.c="",s.closed=!0,Le(s,"onend"),d.call(s,s.strict,s.opt),s}function he(s,i){if(typeof s!="object"||!(s instanceof d))throw new Error("bad call to strictFail");s.strict&&me(s,i)}function We(s){s.strict||(s.tagName=s.tagName[s.looseCase]());var i=s.tags[s.tags.length-1]||s,S=s.tag={name:s.tagName,attributes:{}};s.opt.xmlns&&(S.ns=i.ns),s.attribList.length=0,fe(s,"onopentagstart",S)}function Ue(s,i){var S=s.indexOf(":"),T=S<0?["",s]:s.split(":"),ue=T[0],H=T[1];return i&&s==="xmlns"&&(ue="xmlns",H=""),{prefix:ue,local:H}}function Re(s){if(s.strict||(s.attribName=s.attribName[s.looseCase]()),s.attribList.indexOf(s.attribName)!==-1||s.tag.attributes.hasOwnProperty(s.attribName)){s.attribName=s.attribValue="";return}if(s.opt.xmlns){var i=Ue(s.attribName,!0),S=i.prefix,T=i.local;if(S==="xmlns")if(T==="xml"&&s.attribValue!==se)he(s,"xml: prefix must be bound to "+se+`
Actual: `+s.attribValue);else if(T==="xmlns"&&s.attribValue!==K)he(s,"xmlns: prefix must be bound to "+K+`
Actual: `+s.attribValue);else{var ue=s.tag,H=s.tags[s.tags.length-1]||s;ue.ns===H.ns&&(ue.ns=Object.create(H.ns)),ue.ns[T]=s.attribValue}s.attribList.push([s.attribName,s.attribValue])}else s.tag.attributes[s.attribName]=s.attribValue,fe(s,"onattribute",{name:s.attribName,value:s.attribValue});s.attribName=s.attribValue=""}function qe(s,i){if(s.opt.xmlns){var S=s.tag,T=Ue(s.tagName);S.prefix=T.prefix,S.local=T.local,S.uri=S.ns[T.prefix]||"",S.prefix&&!S.uri&&(he(s,"Unbound namespace prefix: "+JSON.stringify(s.tagName)),S.uri=T.prefix);var ue=s.tags[s.tags.length-1]||s;S.ns&&ue.ns!==S.ns&&Object.keys(S.ns).forEach(function(It){fe(s,"onopennamespace",{prefix:It,uri:S.ns[It]})});for(var H=0,ye=s.attribList.length;H<ye;H++){var Pe=s.attribList[H],be=Pe[0],He=Pe[1],xe=Ue(be,!0),je=xe.prefix,On=xe.local,bt=je===""?"":S.ns[je]||"",Be={name:be,value:He,prefix:je,local:On,uri:bt};je&&je!=="xmlns"&&!bt&&(he(s,"Unbound namespace prefix: "+JSON.stringify(je)),Be.uri=je),s.tag.attributes[be]=Be,fe(s,"onattribute",Be)}s.attribList.length=0}s.tag.isSelfClosing=!!i,s.sawRoot=!0,s.tags.push(s.tag),fe(s,"onopentag",s.tag),i||(!s.noscript&&s.tagName.toLowerCase()==="script"?s.state=N.SCRIPT:s.state=N.TEXT,s.tag=null,s.tagName=""),s.attribName=s.attribValue="",s.attribList.length=0}function Ot(s){if(!s.tagName){he(s,"Weird empty close tag."),s.textNode+="</>",s.state=N.TEXT;return}if(s.script){if(s.tagName!=="script"){s.script+="</"+s.tagName+">",s.tagName="",s.state=N.SCRIPT;return}fe(s,"onscript",s.script),s.script=""}var i=s.tags.length,S=s.tagName;s.strict||(S=S[s.looseCase]());for(var T=S;i--;){var ue=s.tags[i];if(ue.name!==T)he(s,"Unexpected close tag");else break}if(i<0){he(s,"Unmatched closing tag: "+s.tagName),s.textNode+="</"+s.tagName+">",s.state=N.TEXT;return}s.tagName=S;for(var H=s.tags.length;H-- >i;){var ye=s.tag=s.tags.pop();s.tagName=s.tag.name,fe(s,"onclosetag",s.tagName);var Pe={};for(var be in ye.ns)Pe[be]=ye.ns[be];var He=s.tags[s.tags.length-1]||s;s.opt.xmlns&&ye.ns!==He.ns&&Object.keys(ye.ns).forEach(function(xe){var je=ye.ns[xe];fe(s,"onclosenamespace",{prefix:xe,uri:je})})}i===0&&(s.closedRoot=!0),s.tagName=s.attribValue=s.attribName="",s.attribList.length=0,s.state=N.TEXT}function $e(s){var i=s.entity,S=i.toLowerCase(),T,ue="";return s.ENTITIES[i]?s.ENTITIES[i]:s.ENTITIES[S]?s.ENTITIES[S]:(i=S,i.charAt(0)==="#"&&(i.charAt(1)==="x"?(i=i.slice(2),T=parseInt(i,16),ue=T.toString(16)):(i=i.slice(1),T=parseInt(i,10),ue=T.toString(10))),i=i.replace(/^0+/,""),isNaN(T)||ue.toLowerCase()!==i?(he(s,"Invalid character entity"),"&"+s.entity+";"):String.fromCodePoint(T))}function Pt(s,i){i==="<"?(s.state=N.OPEN_WAKA,s.startTagPosition=s.position):W(i)||(he(s,"Non-whitespace before first tag."),s.textNode=i,s.state=N.TEXT)}function it(s,i){var S="";return i<s.length&&(S=s.charAt(i)),S}function ze(s){var i=this;if(this.error)throw this.error;if(i.closed)return me(i,"Cannot write after close. Assign an onready handler.");if(s===null)return Se(i);typeof s=="object"&&(s=s.toString());for(var S=0,T="";T=it(s,S++),i.c=T,!!T;)switch(i.trackPosition&&(i.position++,T===`
`?(i.line++,i.column=0):i.column++),i.state){case N.BEGIN:if(i.state=N.BEGIN_WHITESPACE,T==="\uFEFF")continue;Pt(i,T);continue;case N.BEGIN_WHITESPACE:Pt(i,T);continue;case N.TEXT:if(i.sawRoot&&!i.closedRoot){for(var ue=S-1;T&&T!=="<"&&T!=="&";)T=it(s,S++),T&&i.trackPosition&&(i.position++,T===`
`?(i.line++,i.column=0):i.column++);i.textNode+=s.substring(ue,S-1)}T==="<"&&!(i.sawRoot&&i.closedRoot&&!i.strict)?(i.state=N.OPEN_WAKA,i.startTagPosition=i.position):(!W(T)&&(!i.sawRoot||i.closedRoot)&&he(i,"Text data outside of root node."),T==="&"?i.state=N.TEXT_ENTITY:i.textNode+=T);continue;case N.SCRIPT:T==="<"?i.state=N.SCRIPT_ENDING:i.script+=T;continue;case N.SCRIPT_ENDING:T==="/"?i.state=N.CLOSE_TAG:(i.script+="<"+T,i.state=N.SCRIPT);continue;case N.OPEN_WAKA:if(T==="!")i.state=N.SGML_DECL,i.sgmlDecl="";else if(!W(T))if(re(Q,T))i.state=N.OPEN_TAG,i.tagName=T;else if(T==="/")i.state=N.CLOSE_TAG,i.tagName="";else if(T==="?")i.state=N.PROC_INST,i.procInstName=i.procInstBody="";else{if(he(i,"Unencoded <"),i.startTagPosition+1<i.position){var H=i.position-i.startTagPosition;T=new Array(H).join(" ")+T}i.textNode+="<"+T,i.state=N.TEXT}continue;case N.SGML_DECL:if(i.sgmlDecl+T==="--"){i.state=N.COMMENT,i.comment="",i.sgmlDecl="";continue}i.doctype&&i.doctype!==!0&&i.sgmlDecl?(i.state=N.DOCTYPE_DTD,i.doctype+="<!"+i.sgmlDecl+T,i.sgmlDecl=""):(i.sgmlDecl+T).toUpperCase()===G?(fe(i,"onopencdata"),i.state=N.CDATA,i.sgmlDecl="",i.cdata=""):(i.sgmlDecl+T).toUpperCase()===de?(i.state=N.DOCTYPE,(i.doctype||i.sawRoot)&&he(i,"Inappropriately located doctype declaration"),i.doctype="",i.sgmlDecl=""):T===">"?(fe(i,"onsgmldeclaration",i.sgmlDecl),i.sgmlDecl="",i.state=N.TEXT):(oe(T)&&(i.state=N.SGML_DECL_QUOTED),i.sgmlDecl+=T);continue;case N.SGML_DECL_QUOTED:T===i.q&&(i.state=N.SGML_DECL,i.q=""),i.sgmlDecl+=T;continue;case N.DOCTYPE:T===">"?(i.state=N.TEXT,fe(i,"ondoctype",i.doctype),i.doctype=!0):(i.doctype+=T,T==="["?i.state=N.DOCTYPE_DTD:oe(T)&&(i.state=N.DOCTYPE_QUOTED,i.q=T));continue;case N.DOCTYPE_QUOTED:i.doctype+=T,T===i.q&&(i.q="",i.state=N.DOCTYPE);continue;case N.DOCTYPE_DTD:T==="]"?(i.doctype+=T,i.state=N.DOCTYPE):T==="<"?(i.state=N.OPEN_WAKA,i.startTagPosition=i.position):oe(T)?(i.doctype+=T,i.state=N.DOCTYPE_DTD_QUOTED,i.q=T):i.doctype+=T;continue;case N.DOCTYPE_DTD_QUOTED:i.doctype+=T,T===i.q&&(i.state=N.DOCTYPE_DTD,i.q="");continue;case N.COMMENT:T==="-"?i.state=N.COMMENT_ENDING:i.comment+=T;continue;case N.COMMENT_ENDING:T==="-"?(i.state=N.COMMENT_ENDED,i.comment=ae(i.opt,i.comment),i.comment&&fe(i,"oncomment",i.comment),i.comment=""):(i.comment+="-"+T,i.state=N.COMMENT);continue;case N.COMMENT_ENDED:T!==">"?(he(i,"Malformed comment"),i.comment+="--"+T,i.state=N.COMMENT):i.doctype&&i.doctype!==!0?i.state=N.DOCTYPE_DTD:i.state=N.TEXT;continue;case N.CDATA:T==="]"?i.state=N.CDATA_ENDING:i.cdata+=T;continue;case N.CDATA_ENDING:T==="]"?i.state=N.CDATA_ENDING_2:(i.cdata+="]"+T,i.state=N.CDATA);continue;case N.CDATA_ENDING_2:T===">"?(i.cdata&&fe(i,"oncdata",i.cdata),fe(i,"onclosecdata"),i.cdata="",i.state=N.TEXT):T==="]"?i.cdata+="]":(i.cdata+="]]"+T,i.state=N.CDATA);continue;case N.PROC_INST:T==="?"?i.state=N.PROC_INST_ENDING:W(T)?i.state=N.PROC_INST_BODY:i.procInstName+=T;continue;case N.PROC_INST_BODY:if(!i.procInstBody&&W(T))continue;T==="?"?i.state=N.PROC_INST_ENDING:i.procInstBody+=T;continue;case N.PROC_INST_ENDING:T===">"?(fe(i,"onprocessinginstruction",{name:i.procInstName,body:i.procInstBody}),i.procInstName=i.procInstBody="",i.state=N.TEXT):(i.procInstBody+="?"+T,i.state=N.PROC_INST_BODY);continue;case N.OPEN_TAG:re(ne,T)?i.tagName+=T:(We(i),T===">"?qe(i):T==="/"?i.state=N.OPEN_TAG_SLASH:(W(T)||he(i,"Invalid character in tag name"),i.state=N.ATTRIB));continue;case N.OPEN_TAG_SLASH:T===">"?(qe(i,!0),Ot(i)):(he(i,"Forward-slash in opening tag not followed by >"),i.state=N.ATTRIB);continue;case N.ATTRIB:if(W(T))continue;T===">"?qe(i):T==="/"?i.state=N.OPEN_TAG_SLASH:re(Q,T)?(i.attribName=T,i.attribValue="",i.state=N.ATTRIB_NAME):he(i,"Invalid attribute name");continue;case N.ATTRIB_NAME:T==="="?i.state=N.ATTRIB_VALUE:T===">"?(he(i,"Attribute without value"),i.attribValue=i.attribName,Re(i),qe(i)):W(T)?i.state=N.ATTRIB_NAME_SAW_WHITE:re(ne,T)?i.attribName+=T:he(i,"Invalid attribute name");continue;case N.ATTRIB_NAME_SAW_WHITE:if(T==="=")i.state=N.ATTRIB_VALUE;else{if(W(T))continue;he(i,"Attribute without value"),i.tag.attributes[i.attribName]="",i.attribValue="",fe(i,"onattribute",{name:i.attribName,value:""}),i.attribName="",T===">"?qe(i):re(Q,T)?(i.attribName=T,i.state=N.ATTRIB_NAME):(he(i,"Invalid attribute name"),i.state=N.ATTRIB)}continue;case N.ATTRIB_VALUE:if(W(T))continue;oe(T)?(i.q=T,i.state=N.ATTRIB_VALUE_QUOTED):(i.opt.unquotedAttributeValues||me(i,"Unquoted attribute value"),i.state=N.ATTRIB_VALUE_UNQUOTED,i.attribValue=T);continue;case N.ATTRIB_VALUE_QUOTED:if(T!==i.q){T==="&"?i.state=N.ATTRIB_VALUE_ENTITY_Q:i.attribValue+=T;continue}Re(i),i.q="",i.state=N.ATTRIB_VALUE_CLOSED;continue;case N.ATTRIB_VALUE_CLOSED:W(T)?i.state=N.ATTRIB:T===">"?qe(i):T==="/"?i.state=N.OPEN_TAG_SLASH:re(Q,T)?(he(i,"No whitespace between attributes"),i.attribName=T,i.attribValue="",i.state=N.ATTRIB_NAME):he(i,"Invalid attribute name");continue;case N.ATTRIB_VALUE_UNQUOTED:if(!le(T)){T==="&"?i.state=N.ATTRIB_VALUE_ENTITY_U:i.attribValue+=T;continue}Re(i),T===">"?qe(i):i.state=N.ATTRIB;continue;case N.CLOSE_TAG:if(i.tagName)T===">"?Ot(i):re(ne,T)?i.tagName+=T:i.script?(i.script+="</"+i.tagName,i.tagName="",i.state=N.SCRIPT):(W(T)||he(i,"Invalid tagname in closing tag"),i.state=N.CLOSE_TAG_SAW_WHITE);else{if(W(T))continue;Oe(Q,T)?i.script?(i.script+="</"+T,i.state=N.SCRIPT):he(i,"Invalid tagname in closing tag."):i.tagName=T}continue;case N.CLOSE_TAG_SAW_WHITE:if(W(T))continue;T===">"?Ot(i):he(i,"Invalid characters in closing tag");continue;case N.TEXT_ENTITY:case N.ATTRIB_VALUE_ENTITY_Q:case N.ATTRIB_VALUE_ENTITY_U:var ye,Pe;switch(i.state){case N.TEXT_ENTITY:ye=N.TEXT,Pe="textNode";break;case N.ATTRIB_VALUE_ENTITY_Q:ye=N.ATTRIB_VALUE_QUOTED,Pe="attribValue";break;case N.ATTRIB_VALUE_ENTITY_U:ye=N.ATTRIB_VALUE_UNQUOTED,Pe="attribValue";break}if(T===";"){var be=$e(i);i.opt.unparsedEntities&&!Object.values(p.XML_ENTITIES).includes(be)?(i.entity="",i.state=ye,i.write(be)):(i[Pe]+=be,i.entity="",i.state=ye)}else re(i.entity.length?z:_e,T)?i.entity+=T:(he(i,"Invalid character in entity name"),i[Pe]+="&"+i.entity+T,i.entity="",i.state=ye);continue;default:throw new Error(i,"Unknown state: "+i.state)}return i.position>=i.bufferCheckPosition&&I(i),i}/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */String.fromCodePoint||function(){var s=String.fromCharCode,i=Math.floor,S=function(){var T=16384,ue=[],H,ye,Pe=-1,be=arguments.length;if(!be)return"";for(var He="";++Pe<be;){var xe=Number(arguments[Pe]);if(!isFinite(xe)||xe<0||xe>1114111||i(xe)!==xe)throw RangeError("Invalid code point: "+xe);xe<=65535?ue.push(xe):(xe-=65536,H=(xe>>10)+55296,ye=xe%1024+56320,ue.push(H,ye)),(Pe+1===be||ue.length>T)&&(He+=s.apply(null,ue),ue.length=0)}return He};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:S,configurable:!0,writable:!0}):String.fromCodePoint=S}()})(c)}(no)),no}var Ua=La();const Wt={};function Va(c){const{parentId:p,child:g}=c;Wt[p]||(Wt[p]=[]);const d={id:g.id,tagName:g.tagName};Wt[p].push(d)}function Ga(c){const{currentBatch:p}=c,g=[...p];for(const[d,I]of g.entries()){const k=Wt[I.id]||[];k.length>0&&(g[d].children.push(...k),Wa({parentId:I.id}))}return g}function Wa(c){const{parentId:p}=c;delete Wt[p]}function Ya(c){return"prefix"in c&&"uri"in c&&!!c.prefix&&!!c.uri}const Xa=[".fsd",".asd",".ssd",".scd",".isd",".icd",".xml"],An="sclElements",$a="id, tagName, &attributes.uuid, &attributes.id, attributes.name, parent.id, parent.tagName, *children.id, *children.tagName",Eo={default:{prefix:"",uri:"http://www.iec.ch/61850/2003/SCL"}};function za(c){return c!==null&&typeof c=="object"&&"namespace"in c&&c.namespace!==null}function Ha(){let c={defaultNamespace:null,stack:[],recordsBatch:[]};const p=Ua.parser(!0,{lowercase:!1,trim:!0,normalize:!0,position:!1,xmlns:!0});p.onopentag=I=>c=Qa({node:I,state:c}),p.ontext=I=>c=Ja({text:I,state:c}),p.onclosetag=()=>({updatedState:c}=Za({state:c})),p.onerror=ei;function g(){const I=c.recordsBatch;return c.recordsBatch=[],I}function d(){return c.recordsBatch.length}return{parser:p,drainBatch:g,getSize:d}}function Qa(c){const{node:p,state:g}=c,d={...g},I=ti(p);d.defaultNamespace||(d.defaultNamespace=ni(p));const k=ri(p,d.defaultNamespace),B=oi(p.attributes),D=ai(g.stack),Y={id:crypto.randomUUID(),tagName:I,namespace:k,attributes:B,value:"",parent:D,children:[]};return d.stack.push(Y),d}function Ja(c){const{text:p,state:g}=c;return p&&g.stack.length>0&&(g.stack[g.stack.length-1].value+=p),g}function Za(c){const{state:p}=c,g=p.stack.at(-1);let d=p.stack.slice(0,-1);const I=[...p.recordsBatch];if(g){if(d.length){const k=d.length-1;d=d.map((B,D)=>D===k?{...B,children:[...B.children,{id:g.id,tagName:g.tagName}]}:B)}else g.parent&&Va({parentId:g.parent.id,child:{id:g.id,tagName:g.tagName}});I.push(g)}return{updatedState:{defaultNamespace:p.defaultNamespace,stack:d,recordsBatch:I}}}function ei(c){return new Error(`XML parsing error: ${c}`)}function ti(c){return c.local||null}function ni(c){if(c.name!=="SCL")throw new Error("Default namespace can only be set on SCL element");return c.attributes?.xmlns?.value?{prefix:"",uri:c.attributes.xmlns.value}:Eo.default}function ri(c,p){return Ya(c)?{prefix:c.prefix,uri:c.uri}:p}function oi(c){return Object.values(c).map(p=>{const g=p.prefix&&p.uri?{prefix:p.prefix,uri:p.uri}:void 0;return{name:p.name,value:p.value,...g&&{namespace:g}}})}function ai(c){if(c.length===0)return null;const p=c[c.length-1];return p?{id:p.id,tagName:p.tagName}:null}var dr={exports:{}},ii=dr.exports,ao;function si(){return ao||(ao=1,function(c,p){(function(g,d){c.exports=d()})(ii,function(){var g=function(e,t){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])})(e,t)},d=function(){return(d=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function I(e,t,n){for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||((r=r||Array.prototype.slice.call(t,0,o))[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}var k=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Ma,B=Object.keys,D=Array.isArray;function Y(e,t){return typeof t!="object"||B(t).forEach(function(n){e[n]=t[n]}),e}typeof Promise>"u"||k.Promise||(k.Promise=Promise);var $=Object.getPrototypeOf,ee={}.hasOwnProperty;function G(e,t){return ee.call(e,t)}function de(e,t){typeof t=="function"&&(t=t($(e))),(typeof Reflect>"u"?B:Reflect.ownKeys)(t).forEach(function(n){K(e,n,t[n])})}var se=Object.defineProperty;function K(e,t,n,r){se(e,t,Y(n&&G(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function C(e){return{from:function(t){return e.prototype=Object.create(t.prototype),K(e.prototype,"constructor",e),{extend:de.bind(null,e.prototype)}}}}var Q=Object.getOwnPropertyDescriptor,ne=[].slice;function _e(e,t,n){return ne.call(e,t,n)}function z(e,t){return t(e)}function W(e){if(!e)throw new Error("Assertion Failed")}function oe(e){k.setImmediate?setImmediate(e):setTimeout(e,0)}function le(e,t){if(typeof t=="string"&&G(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var n=[],r=0,o=t.length;r<o;++r){var a=le(e,t[r]);n.push(a)}return n}var u=t.indexOf(".");if(u!==-1){var l=e[t.substr(0,u)];return l==null?void 0:le(l,t.substr(u+1))}}function re(e,t,n){if(e&&t!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){W(typeof n!="string"&&"length"in n);for(var r=0,o=t.length;r<o;++r)re(e,t[r],n[r])}else{var a,u,l=t.indexOf(".");l!==-1?(a=t.substr(0,l),(u=t.substr(l+1))===""?n===void 0?D(e)&&!isNaN(parseInt(a))?e.splice(a,1):delete e[a]:e[a]=n:re(l=!(l=e[a])||!G(e,a)?e[a]={}:l,u,n)):n===void 0?D(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function Oe(e){var t,n={};for(t in e)G(e,t)&&(n[t]=e[t]);return n}var N=[].concat;function at(e){return N.apply([],e)}var st="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(at([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return k[e]}),Le=new Set(st.map(function(e){return k[e]})),fe=null;function De(e){return fe=new WeakMap,e=function t(n){if(!n||typeof n!="object")return n;var r=fe.get(n);if(r)return r;if(D(n)){r=[],fe.set(n,r);for(var o=0,a=n.length;o<a;++o)r.push(t(n[o]))}else if(Le.has(n.constructor))r=n;else{var u,l=$(n);for(u in r=l===Object.prototype?{}:Object.create(l),fe.set(n,r),n)G(n,u)&&(r[u]=t(n[u]))}return r}(e),fe=null,e}var ae={}.toString;function me(e){return ae.call(e).slice(8,-1)}var Se=typeof Symbol<"u"?Symbol.iterator:"@@iterator",he=typeof Se=="symbol"?function(e){var t;return e!=null&&(t=e[Se])&&t.apply(e)}:function(){return null};function We(e,t){return t=e.indexOf(t),0<=t&&e.splice(t,1),0<=t}var Ue={};function Re(e){var t,n,r,o;if(arguments.length===1){if(D(e))return e.slice();if(this===Ue&&typeof e=="string")return[e];if(o=he(e)){for(n=[];!(r=o.next()).done;)n.push(r.value);return n}if(e==null)return[e];if(typeof(t=e.length)!="number")return[e];for(n=new Array(t);t--;)n[t]=e[t];return n}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var qe=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},kt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ke=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(kt),Ot={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function $e(e,t){this.name=e,this.message=t}function Pt(e,t){return e+". Errors: "+Object.keys(t).map(function(n){return t[n].toString()}).filter(function(n,r,o){return o.indexOf(n)===r}).join(`
`)}function it(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Pt(e,t)}function ze(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(n){return t[n]}),this.failuresByPos=t,this.message=Pt(e,this.failures)}C($e).from(Error).extend({toString:function(){return this.name+": "+this.message}}),C(it).from($e),C(ze).from($e);var s=Ke.reduce(function(e,t){return e[t]=t+"Error",e},{}),i=$e,S=Ke.reduce(function(e,t){var n=t+"Error";function r(o,a){this.name=n,o?typeof o=="string"?(this.message="".concat(o).concat(a?`
 `+a:""),this.inner=a||null):typeof o=="object"&&(this.message="".concat(o.name," ").concat(o.message),this.inner=o):(this.message=Ot[t]||n,this.inner=null)}return C(r).from(i),e[t]=r,e},{});S.Syntax=SyntaxError,S.Type=TypeError,S.Range=RangeError;var T=kt.reduce(function(e,t){return e[t+"Error"]=S[t],e},{}),ue=Ke.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=S[t]),e},{});function H(){}function ye(e){return e}function Pe(e,t){return e==null||e===ye?t:function(n){return t(e(n))}}function be(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function He(e,t){return e===H?t:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?be(r,this.onsuccess):r),o&&(this.onerror=this.onerror?be(o,this.onerror):o),a!==void 0?a:n}}function xe(e,t){return e===H?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?be(n,this.onsuccess):n),r&&(this.onerror=this.onerror?be(r,this.onerror):r)}}function je(e,t){return e===H?t:function(n){var r=e.apply(this,arguments);Y(n,r);var o=this.onsuccess,a=this.onerror;return this.onsuccess=null,this.onerror=null,n=t.apply(this,arguments),o&&(this.onsuccess=this.onsuccess?be(o,this.onsuccess):o),a&&(this.onerror=this.onerror?be(a,this.onerror):a),r===void 0?n===void 0?void 0:n:Y(r,n)}}function On(e,t){return e===H?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function bt(e,t){return e===H?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,o=arguments.length,a=new Array(o);o--;)a[o]=arguments[o];return n.then(function(){return t.apply(r,a)})}return t.apply(this,arguments)}}ue.ModifyError=it,ue.DexieError=$e,ue.BulkError=ze;var Be=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function It(e){Be=e}var Ct={},vr=100,st=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,$(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,$(t),e]}(),kt=st[0],Ke=st[1],st=st[2],Ke=Ke&&Ke.then,ut=kt&&kt.constructor,Pn=!!st,Dt=function(e,t){Ft.push([e,t]),Xt&&(queueMicrotask(Ao),Xt=!1)},In=!0,Xt=!0,ct=[],$t=[],Cn=ye,Qe={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:H,pgp:!1,env:{},finalize:H},X=Qe,Ft=[],lt=0,zt=[];function U(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=X;if(typeof e!="function"){if(e!==Ct)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Dn(this,this._value))}this._state=null,this._value=null,++t.ref,function n(r,o){try{o(function(a){if(r._state===null){if(a===r)throw new TypeError("A promise cannot be resolved with itself.");var u=r._lib&&wt();a&&typeof a.then=="function"?n(r,function(l,h){a instanceof U?a._then(l,h):a.then(l,h)}):(r._state=!0,r._value=a,br(r)),u&&_t()}},Dn.bind(null,r))}catch(a){Dn(r,a)}}(this,e)}var kn={get:function(){var e=X,t=Zt;function n(r,o){var a=this,u=!e.global&&(e!==X||t!==Zt),l=u&&!Ze(),h=new U(function(y,b){Fn(a,new gr(_r(r,e,u,l),_r(o,e,u,l),y,b,e))});return this._consoleTask&&(h._consoleTask=this._consoleTask),h}return n.prototype=Ct,n},set:function(e){K(this,"then",e&&e.prototype===Ct?kn:{get:function(){return e},set:kn.set})}};function gr(e,t,n,r,o){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=n,this.reject=r,this.psd=o}function Dn(e,t){var n,r;$t.push(t),e._state===null&&(n=e._lib&&wt(),t=Cn(t),e._state=!1,e._value=t,r=e,ct.some(function(o){return o._value===r._value})||ct.push(r),br(e),n&&_t())}function br(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)Fn(e,t[n]);var o=e._PSD;--o.ref||o.finalize(),lt===0&&(++lt,Dt(function(){--lt==0&&Bn()},[]))}function Fn(e,t){if(e._state!==null){var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++lt,Dt(No,[n,e,t])}else e._listeners.push(t)}function No(e,t,n){try{var r,o=t._value;!t._state&&$t.length&&($t=[]),r=Be&&t._consoleTask?t._consoleTask.run(function(){return e(o)}):e(o),t._state||$t.indexOf(o)!==-1||function(a){for(var u=ct.length;u;)if(ct[--u]._value===a._value)return ct.splice(u,1)}(t),n.resolve(r)}catch(a){n.reject(a)}finally{--lt==0&&Bn(),--n.psd.ref||n.psd.finalize()}}function Ao(){ft(Qe,function(){wt()&&_t()})}function wt(){var e=In;return Xt=In=!1,e}function _t(){var e,t,n;do for(;0<Ft.length;)for(e=Ft,Ft=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}while(0<Ft.length);Xt=In=!0}function Bn(){var e=ct;ct=[],e.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var t=zt.slice(0),n=t.length;n;)t[--n]()}function Ht(e){return new U(Ct,!1,e)}function ge(e,t){var n=X;return function(){var r=wt(),o=X;try{return et(n,!0),e.apply(this,arguments)}catch(a){t&&t(a)}finally{et(o,!1),r&&_t()}}}de(U.prototype,{then:kn,_then:function(e,t){Fn(this,new gr(null,null,e,t,X))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=e,n=arguments[1];return typeof t=="function"?this.then(null,function(r){return(r instanceof t?n:Ht)(r)}):this.then(null,function(r){return(r&&r.name===t?n:Ht)(r)})},finally:function(e){return this.then(function(t){return U.resolve(e()).then(function(){return t})},function(t){return U.resolve(e()).then(function(){return Ht(t)})})},timeout:function(e,t){var n=this;return e<1/0?new U(function(r,o){var a=setTimeout(function(){return o(new S.Timeout(t))},e);n.then(r,o).finally(clearTimeout.bind(null,a))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&K(U.prototype,Symbol.toStringTag,"Dexie.Promise"),Qe.env=wr(),de(U,{all:function(){var e=Re.apply(null,arguments).map(en);return new U(function(t,n){e.length===0&&t([]);var r=e.length;e.forEach(function(o,a){return U.resolve(o).then(function(u){e[a]=u,--r||t(e)},n)})})},resolve:function(e){return e instanceof U?e:e&&typeof e.then=="function"?new U(function(t,n){e.then(t,n)}):new U(Ct,!0,e)},reject:Ht,race:function(){var e=Re.apply(null,arguments).map(en);return new U(function(t,n){e.map(function(r){return U.resolve(r).then(t,n)})})},PSD:{get:function(){return X},set:function(e){return X=e}},totalEchoes:{get:function(){return Zt}},newPSD:Je,usePSD:ft,scheduler:{get:function(){return Dt},set:function(e){Dt=e}},rejectionMapper:{get:function(){return Cn},set:function(e){Cn=e}},follow:function(e,t){return new U(function(n,r){return Je(function(o,a){var u=X;u.unhandleds=[],u.onunhandled=a,u.finalize=be(function(){var l,h=this;l=function(){h.unhandleds.length===0?o():a(h.unhandleds[0])},zt.push(function y(){l(),zt.splice(zt.indexOf(y),1)}),++lt,Dt(function(){--lt==0&&Bn()},[])},u.finalize),e()},t,n,r)})}}),ut&&(ut.allSettled&&K(U,"allSettled",function(){var e=Re.apply(null,arguments).map(en);return new U(function(t){e.length===0&&t([]);var n=e.length,r=new Array(n);e.forEach(function(o,a){return U.resolve(o).then(function(u){return r[a]={status:"fulfilled",value:u}},function(u){return r[a]={status:"rejected",reason:u}}).then(function(){return--n||t(r)})})})}),ut.any&&typeof AggregateError<"u"&&K(U,"any",function(){var e=Re.apply(null,arguments).map(en);return new U(function(t,n){e.length===0&&n(new AggregateError([]));var r=e.length,o=new Array(r);e.forEach(function(a,u){return U.resolve(a).then(function(l){return t(l)},function(l){o[u]=l,--r||n(new AggregateError(o))})})})}),ut.withResolvers&&(U.withResolvers=ut.withResolvers));var Ne={awaits:0,echoes:0,id:0},Oo=0,Qt=[],Jt=0,Zt=0,Po=0;function Je(e,t,n,r){var o=X,a=Object.create(o);return a.parent=o,a.ref=0,a.global=!1,a.id=++Po,Qe.env,a.env=Pn?{Promise:U,PromiseProp:{value:U,configurable:!0,writable:!0},all:U.all,race:U.race,allSettled:U.allSettled,any:U.any,resolve:U.resolve,reject:U.reject}:{},t&&Y(a,t),++o.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()},r=ft(a,e,n,r),a.ref===0&&a.finalize(),r}function Et(){return Ne.id||(Ne.id=++Oo),++Ne.awaits,Ne.echoes+=vr,Ne.id}function Ze(){return!!Ne.awaits&&(--Ne.awaits==0&&(Ne.id=0),Ne.echoes=Ne.awaits*vr,!0)}function en(e){return Ne.echoes&&e&&e.constructor===ut?(Et(),e.then(function(t){return Ze(),t},function(t){return Ze(),Ee(t)})):e}function Io(){var e=Qt[Qt.length-1];Qt.pop(),et(e,!1)}function et(e,t){var n,r=X;(t?!Ne.echoes||Jt++&&e===X:!Jt||--Jt&&e===X)||queueMicrotask(t?(function(o){++Zt,Ne.echoes&&--Ne.echoes!=0||(Ne.echoes=Ne.awaits=Ne.id=0),Qt.push(X),et(o,!0)}).bind(null,e):Io),e!==X&&(X=e,r===Qe&&(Qe.env=wr()),Pn&&(n=Qe.env.Promise,t=e.env,(r.global||e.global)&&(Object.defineProperty(k,"Promise",t.PromiseProp),n.all=t.all,n.race=t.race,n.resolve=t.resolve,n.reject=t.reject,t.allSettled&&(n.allSettled=t.allSettled),t.any&&(n.any=t.any))))}function wr(){var e=k.Promise;return Pn?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(k,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function ft(e,t,n,r,o){var a=X;try{return et(e,!0),t(n,r,o)}finally{et(a,!1)}}function _r(e,t,n,r){return typeof e!="function"?e:function(){var o=X;n&&Et(),et(t,!0);try{return e.apply(this,arguments)}finally{et(o,!1),r&&queueMicrotask(Ze)}}}function Rn(e){Promise===ut&&Ne.echoes===0?Jt===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+Ke).indexOf("[native code]")===-1&&(Et=Ze=H);var Ee=U.reject,pt="ï¿¿",Ye="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Er="String expected.",Tt=[],tn="__dbnames",Mn="readonly",Kn="readwrite";function dt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var Tr={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function nn(e){return typeof e!="string"||/\./.test(e)?function(t){return t}:function(t){return t[e]===void 0&&e in t&&delete(t=De(t))[e],t}}function xr(){throw S.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function ie(e,t){try{var n=Sr(e),r=Sr(t);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":return function(o,a){for(var u=o.length,l=a.length,h=u<l?u:l,y=0;y<h;++y)if(o[y]!==a[y])return o[y]<a[y]?-1:1;return u===l?0:u<l?-1:1}(Nr(e),Nr(t));case"Array":return function(o,a){for(var u=o.length,l=a.length,h=u<l?u:l,y=0;y<h;++y){var b=ie(o[y],a[y]);if(b!==0)return b}return u===l?0:u<l?-1:1}(e,t)}}catch{}return NaN}function Sr(e){var t=typeof e;return t!="object"?t:ArrayBuffer.isView(e)?"binary":(e=me(e),e==="ArrayBuffer"?"binary":e)}function Nr(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function rn(e,t,n){var r=e.schema.yProps;return r?(t&&0<n.numFailures&&(t=t.filter(function(o,a){return!n.failures[a]})),Promise.all(r.map(function(o){return o=o.updatesTable,t?e.db.table(o).where("k").anyOf(t).delete():e.db.table(o).clear()})).then(function(){return n})):n}var Ar=(ve.prototype._trans=function(e,t,n){var r=this._tx||X.trans,o=this.name,a=Be&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function u(y,b,f){if(!f.schema[o])throw new S.NotFound("Table "+o+" not part of transaction");return t(f.idbtrans,f)}var l=wt();try{var h=r&&r.db._novip===this.db._novip?r===X.trans?r._promise(e,u,n):Je(function(){return r._promise(e,u,n)},{trans:r,transless:X.transless||X}):function y(b,f,E,m){if(b.idbdb&&(b._state.openComplete||X.letThrough||b._vip)){var v=b._createTransaction(f,E,b._dbSchema);try{v.create(),b._state.PR1398_maxLoop=3}catch(_){return _.name===s.InvalidState&&b.isOpen()&&0<--b._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),b.close({disableAutoOpen:!1}),b.open().then(function(){return y(b,f,E,m)})):Ee(_)}return v._promise(f,function(_,w){return Je(function(){return X.trans=v,m(_,w,v)})}).then(function(_){if(f==="readwrite")try{v.idbtrans.commit()}catch{}return f==="readonly"?_:v._completion.then(function(){return _})})}if(b._state.openComplete)return Ee(new S.DatabaseClosed(b._state.dbOpenError));if(!b._state.isBeingOpened){if(!b._state.autoOpen)return Ee(new S.DatabaseClosed);b.open().catch(H)}return b._state.dbReadyPromise.then(function(){return y(b,f,E,m)})}(this.db,e,[this.name],u);return a&&(h._consoleTask=a,h=h.catch(function(y){return console.trace(y),Ee(y)})),h}finally{l&&_t()}},ve.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?Ee(new S.Type("Invalid argument to Table.get()")):this._trans("readonly",function(r){return n.core.get({trans:r,key:e}).then(function(o){return n.hook.reading.fire(o)})}).then(t)},ve.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(D(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=B(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(l){if(l.compound&&t.every(function(y){return 0<=l.keyPath.indexOf(y)})){for(var h=0;h<t.length;++h)if(t.indexOf(l.keyPath[h])===-1)return!1;return!0}return!1}).sort(function(l,h){return l.keyPath.length-h.keyPath.length})[0];if(n&&this.db._maxKey!==pt){var a=n.keyPath.slice(0,t.length);return this.where(a).equals(a.map(function(h){return e[h]}))}!n&&Be&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var r=this.schema.idxByName;function o(l,h){return ie(l,h)===0}var u=t.reduce(function(f,h){var y=f[0],b=f[1],f=r[h],E=e[h];return[y||f,y||!f?dt(b,f&&f.multi?function(m){return m=le(m,h),D(m)&&m.some(function(v){return o(E,v)})}:function(m){return o(E,le(m,h))}):b]},[null,null]),a=u[0],u=u[1];return a?this.where(a.name).equals(e[a.keyPath]).filter(u):n?this.filter(u):this.where(t).equals("")},ve.prototype.filter=function(e){return this.toCollection().and(e)},ve.prototype.count=function(e){return this.toCollection().count(e)},ve.prototype.offset=function(e){return this.toCollection().offset(e)},ve.prototype.limit=function(e){return this.toCollection().limit(e)},ve.prototype.each=function(e){return this.toCollection().each(e)},ve.prototype.toArray=function(e){return this.toCollection().toArray(e)},ve.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},ve.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,D(e)?"[".concat(e.join("+"),"]"):e))},ve.prototype.reverse=function(){return this.toCollection().reverse()},ve.prototype.mapToClass=function(e){var t,n=this.db,r=this.name;function o(){return t!==null&&t.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof xr&&(function(h,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function b(){this.constructor=h}g(h,y),h.prototype=y===null?Object.create(y):(b.prototype=y.prototype,new b)}(o,t=e),Object.defineProperty(o.prototype,"db",{get:function(){return n},enumerable:!1,configurable:!0}),o.prototype.table=function(){return r},e=o);for(var a=new Set,u=e.prototype;u;u=$(u))Object.getOwnPropertyNames(u).forEach(function(h){return a.add(h)});function l(h){if(!h)return h;var y,b=Object.create(e.prototype);for(y in h)if(!a.has(y))try{b[y]=h[y]}catch{}return b}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=l,this.hook("reading",l),e},ve.prototype.defineClass=function(){return this.mapToClass(function(e){Y(this,e)})},ve.prototype.add=function(e,t){var n=this,r=this.schema.primKey,o=r.auto,a=r.keyPath,u=e;return a&&o&&(u=nn(a)(e)),this._trans("readwrite",function(l){return n.core.mutate({trans:l,type:"add",keys:t!=null?[t]:null,values:[u]})}).then(function(l){return l.numFailures?U.reject(l.failures[0]):l.lastResult}).then(function(l){if(a)try{re(e,a,l)}catch{}return l})},ve.prototype.update=function(e,t){return typeof e!="object"||D(e)?this.where(":id").equals(e).modify(t):(e=le(e,this.schema.primKey.keyPath),e===void 0?Ee(new S.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t))},ve.prototype.put=function(e,t){var n=this,r=this.schema.primKey,o=r.auto,a=r.keyPath,u=e;return a&&o&&(u=nn(a)(e)),this._trans("readwrite",function(l){return n.core.mutate({trans:l,type:"put",values:[u],keys:t!=null?[t]:null})}).then(function(l){return l.numFailures?U.reject(l.failures[0]):l.lastResult}).then(function(l){if(a)try{re(e,a,l)}catch{}return l})},ve.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]}).then(function(r){return rn(t,[e],r)}).then(function(r){return r.numFailures?U.reject(r.failures[0]):void 0})})},ve.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:Tr}).then(function(n){return rn(e,null,n)})}).then(function(t){return t.numFailures?U.reject(t.failures[0]):void 0})},ve.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(n){return t.core.getMany({keys:e,trans:n}).then(function(r){return r.map(function(o){return t.hook.reading.fire(o)})})})},ve.prototype.bulkAdd=function(e,t,n){var r=this,o=Array.isArray(t)?t:void 0,a=(n=n||(o?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(u){var y=r.schema.primKey,l=y.auto,y=y.keyPath;if(y&&o)throw new S.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new S.InvalidArgument("Arguments objects and keys must have the same length");var h=e.length,y=y&&l?e.map(nn(y)):e;return r.core.mutate({trans:u,type:"add",keys:o,values:y,wantResults:a}).then(function(v){var f=v.numFailures,E=v.results,m=v.lastResult,v=v.failures;if(f===0)return a?E:m;throw new ze("".concat(r.name,".bulkAdd(): ").concat(f," of ").concat(h," operations failed"),v)})})},ve.prototype.bulkPut=function(e,t,n){var r=this,o=Array.isArray(t)?t:void 0,a=(n=n||(o?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(u){var y=r.schema.primKey,l=y.auto,y=y.keyPath;if(y&&o)throw new S.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new S.InvalidArgument("Arguments objects and keys must have the same length");var h=e.length,y=y&&l?e.map(nn(y)):e;return r.core.mutate({trans:u,type:"put",keys:o,values:y,wantResults:a}).then(function(v){var f=v.numFailures,E=v.results,m=v.lastResult,v=v.failures;if(f===0)return a?E:m;throw new ze("".concat(r.name,".bulkPut(): ").concat(f," of ").concat(h," operations failed"),v)})})},ve.prototype.bulkUpdate=function(e){var t=this,n=this.core,r=e.map(function(u){return u.key}),o=e.map(function(u){return u.changes}),a=[];return this._trans("readwrite",function(u){return n.getMany({trans:u,keys:r,cache:"clone"}).then(function(l){var h=[],y=[];e.forEach(function(f,E){var m=f.key,v=f.changes,_=l[E];if(_){for(var w=0,x=Object.keys(v);w<x.length;w++){var A=x[w],O=v[A];if(A===t.schema.primKey.keyPath){if(ie(O,m)!==0)throw new S.Constraint("Cannot update primary key in bulkUpdate()")}else re(_,A,O)}a.push(E),h.push(m),y.push(_)}});var b=h.length;return n.mutate({trans:u,type:"put",keys:h,values:y,updates:{keys:r,changeSpecs:o}}).then(function(f){var E=f.numFailures,m=f.failures;if(E===0)return b;for(var v=0,_=Object.keys(m);v<_.length;v++){var w,x=_[v],A=a[Number(x)];A!=null&&(w=m[x],delete m[x],m[A]=w)}throw new ze("".concat(t.name,".bulkUpdate(): ").concat(E," of ").concat(b," operations failed"),m)})})})},ve.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",function(r){return t.core.mutate({trans:r,type:"delete",keys:e}).then(function(o){return rn(t,e,o)})}).then(function(u){var o=u.numFailures,a=u.lastResult,u=u.failures;if(o===0)return a;throw new ze("".concat(t.name,".bulkDelete(): ").concat(o," of ").concat(n," operations failed"),u)})},ve);function ve(){}function Bt(e){function t(u,l){if(l){for(var h=arguments.length,y=new Array(h-1);--h;)y[h-1]=arguments[h];return n[u].subscribe.apply(null,y),e}if(typeof u=="string")return n[u]}var n={};t.addEventType=a;for(var r=1,o=arguments.length;r<o;++r)a(arguments[r]);return t;function a(u,l,h){if(typeof u!="object"){var y;l=l||On;var b={subscribers:[],fire:h=h||H,subscribe:function(f){b.subscribers.indexOf(f)===-1&&(b.subscribers.push(f),b.fire=l(b.fire,f))},unsubscribe:function(f){b.subscribers=b.subscribers.filter(function(E){return E!==f}),b.fire=b.subscribers.reduce(l,h)}};return n[u]=t[u]=b}B(y=u).forEach(function(f){var E=y[f];if(D(E))a(f,y[f][0],y[f][1]);else{if(E!=="asap")throw new S.InvalidArgument("Invalid event config");var m=a(f,ye,function(){for(var v=arguments.length,_=new Array(v);v--;)_[v]=arguments[v];m.subscribers.forEach(function(w){oe(function(){w.apply(null,_)})})})}})}}function Rt(e,t){return C(t).from({prototype:e}),t}function xt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function qn(e,t){e.filter=dt(e.filter,t)}function jn(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return dt(r(),t())}:t,e.justLimit=n&&!r}function on(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new S.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Or(e,t,n){var r=on(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:r,range:e.range}})}function an(e,t,n,r){var o=e.replayFilter?dt(e.filter,e.replayFilter()):e.filter;if(e.or){var a={},u=function(l,h,y){var b,f;o&&!o(h,y,function(E){return h.stop(E)},function(E){return h.fail(E)})||((f=""+(b=h.primaryKey))=="[object ArrayBuffer]"&&(f=""+new Uint8Array(b)),G(a,f)||(a[f]=!0,t(l,h,y)))};return Promise.all([e.or._iterate(u,n),Pr(Or(e,r,n),e.algorithm,u,!e.keysOnly&&e.valueMapper)])}return Pr(Or(e,r,n),dt(e.algorithm,o),t,!e.keysOnly&&e.valueMapper)}function Pr(e,t,n,r){var o=ge(r?function(a,u,l){return n(r(a),u,l)}:n);return e.then(function(a){if(a)return a.start(function(){var u=function(){return a.continue()};t&&!t(a,function(l){return u=l},function(l){a.stop(l),u=H},function(l){a.fail(l),u=H})||o(a.value,a,function(l){return u=l}),u()})})}var Mt=(Ir.prototype.execute=function(e){var t=this["@@propmod"];if(t.add!==void 0){var n=t.add;if(D(n))return I(I([],D(e)?e:[],!0),n).sort();if(typeof n=="number")return(Number(e)||0)+n;if(typeof n=="bigint")try{return BigInt(e)+n}catch{return BigInt(0)+n}throw new TypeError("Invalid term ".concat(n))}if(t.remove!==void 0){var r=t.remove;if(D(r))return D(e)?e.filter(function(o){return!r.includes(o)}).sort():[];if(typeof r=="number")return Number(e)-r;if(typeof r=="bigint")try{return BigInt(e)-r}catch{return BigInt(0)-r}throw new TypeError("Invalid subtrahend ".concat(r))}return n=(n=t.replacePrefix)===null||n===void 0?void 0:n[0],n&&typeof e=="string"&&e.startsWith(n)?t.replacePrefix[1]+e.substring(n.length):e},Ir);function Ir(e){this["@@propmod"]=e}var Co=(pe.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,Ee.bind(null,n.error)):n.table._trans("readonly",e).then(t)},pe.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,Ee.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},pe.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=dt(t.algorithm,e)},pe.prototype._iterate=function(e,t){return an(this._ctx,e,t,this._ctx.table.core)},pe.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&Y(n,e),t._ctx=n,t},pe.prototype.raw=function(){return this._ctx.valueMapper=null,this},pe.prototype.each=function(e){var t=this._ctx;return this._read(function(n){return an(t,e,n,t.table.core)})},pe.prototype.count=function(e){var t=this;return this._read(function(n){var r=t._ctx,o=r.table.core;if(xt(r,!0))return o.count({trans:n,query:{index:on(r,o.schema),range:r.range}}).then(function(u){return Math.min(u,r.limit)});var a=0;return an(r,function(){return++a,!1},n,o).then(function(){return a})}).then(e)},pe.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),r=n[0],o=n.length-1;function a(h,y){return y?a(h[n[y]],y-1):h[r]}var u=this._ctx.dir==="next"?1:-1;function l(h,y){return ie(a(h,o),a(y,o))*u}return this.toArray(function(h){return h.sort(l)}).then(t)},pe.prototype.toArray=function(e){var t=this;return this._read(function(n){var r=t._ctx;if(r.dir==="next"&&xt(r,!0)&&0<r.limit){var o=r.valueMapper,a=on(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:a,range:r.range}}).then(function(l){return l=l.result,o?l.map(o):l})}var u=[];return an(r,function(l){return u.push(l)},n,r.table.core).then(function(){return u})},e)},pe.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,xt(t)?jn(t,function(){var n=e;return function(r,o){return n===0||(n===1?--n:o(function(){r.advance(n),n=0}),!1)}}):jn(t,function(){var n=e;return function(){return--n<0}})),this},pe.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),jn(this._ctx,function(){var t=e;return function(n,r,o){return--t<=0&&r(o),0<=t}},!0),this},pe.prototype.until=function(e,t){return qn(this._ctx,function(n,r,o){return!e(n.value)||(r(o),t)}),this},pe.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},pe.prototype.last=function(e){return this.reverse().first(e)},pe.prototype.filter=function(e){var t;return qn(this._ctx,function(n){return e(n.value)}),(t=this._ctx).isMatch=dt(t.isMatch,e),this},pe.prototype.and=function(e){return this.filter(e)},pe.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},pe.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},pe.prototype.desc=function(){return this.reverse()},pe.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,r){e(r.key,r)})},pe.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},pe.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,r){e(r.primaryKey,r)})},pe.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(r,o){n.push(o.key)}).then(function(){return n}).then(e)},pe.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir==="next"&&xt(t,!0)&&0<t.limit)return this._read(function(r){var o=on(t,t.table.core.schema);return t.table.core.query({trans:r,values:!1,limit:t.limit,query:{index:o,range:t.range}})}).then(function(r){return r.result}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(r,o){n.push(o.primaryKey)}).then(function(){return n}).then(e)},pe.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},pe.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},pe.prototype.lastKey=function(e){return this.reverse().firstKey(e)},pe.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var t={};return qn(this._ctx,function(o){var r=o.primaryKey.toString(),o=G(t,r);return t[r]=!0,!o}),this},pe.prototype.modify=function(e){var t=this,n=this._ctx;return this._write(function(r){var o,a,u;u=typeof e=="function"?e:(o=B(e),a=o.length,function(x){for(var A=!1,O=0;O<a;++O){var P=o[O],F=e[P],q=le(x,P);F instanceof Mt?(re(x,P,F.execute(q)),A=!0):q!==F&&(re(x,P,F),A=!0)}return A});var l=n.table.core,f=l.schema.primaryKey,h=f.outbound,y=f.extractKey,b=200,f=t.db._options.modifyChunkSize;f&&(b=typeof f=="object"?f[l.name]||f["*"]||200:f);function E(x,P){var O=P.failures,P=P.numFailures;v+=x-P;for(var F=0,q=B(O);F<q.length;F++){var R=q[F];m.push(O[R])}}var m=[],v=0,_=[],w=e===Cr;return t.clone().primaryKeys().then(function(x){function A(P){var F=Math.min(b,x.length-P),q=x.slice(P,P+F);return(w?Promise.resolve([]):l.getMany({trans:r,keys:q,cache:"immutable"})).then(function(R){var M=[],L=[],j=h?[]:null,V=w?q:[];if(!w)for(var te=0;te<F;++te){var ce=R[te],Z={value:De(ce),primKey:x[P+te]};u.call(Z,Z.value,Z)!==!1&&(Z.value==null?V.push(x[P+te]):h||ie(y(ce),y(Z.value))===0?(L.push(Z.value),h&&j.push(x[P+te])):(V.push(x[P+te]),M.push(Z.value)))}return Promise.resolve(0<M.length&&l.mutate({trans:r,type:"add",values:M}).then(function(we){for(var J in we.failures)V.splice(parseInt(J),1);E(M.length,we)})).then(function(){return(0<L.length||O&&typeof e=="object")&&l.mutate({trans:r,type:"put",keys:j,values:L,criteria:O,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<P}).then(function(we){return E(L.length,we)})}).then(function(){return(0<V.length||O&&w)&&l.mutate({trans:r,type:"delete",keys:V,criteria:O,isAdditionalChunk:0<P}).then(function(we){return rn(n.table,V,we)}).then(function(we){return E(V.length,we)})}).then(function(){return x.length>P+F&&A(P+b)})})}var O=xt(n)&&n.limit===1/0&&(typeof e!="function"||w)&&{index:n.index,range:n.range};return A(0).then(function(){if(0<m.length)throw new it("Error modifying one or more objects",m,v,_);return x.length})})})},pe.prototype.delete=function(){var e=this._ctx,t=e.range;return!xt(e)||e.table.schema.yProps||!e.isPrimKey&&t.type!==3?this.modify(Cr):this._write(function(n){var r=e.table.core.schema.primaryKey,o=t;return e.table.core.count({trans:n,query:{index:r,range:o}}).then(function(a){return e.table.core.mutate({trans:n,type:"deleteRange",range:o}).then(function(h){var l=h.failures,h=h.numFailures;if(h)throw new it("Could not delete some values",Object.keys(l).map(function(y){return l[y]}),a-h);return a-h})})})},pe);function pe(){}var Cr=function(e,t){return t.value=null};function ko(e,t){return e<t?-1:e===t?0:1}function Do(e,t){return t<e?-1:e===t?0:1}function Me(e,t,n){return e=e instanceof Dr?new e.Collection(e):e,e._ctx.error=new(n||TypeError)(t),e}function St(e){return new e.Collection(e,function(){return kr("")}).limit(0)}function sn(e,t,n,r){var o,a,u,l,h,y,b,f=n.length;if(!n.every(function(v){return typeof v=="string"}))return Me(e,Er);function E(v){o=v==="next"?function(w){return w.toUpperCase()}:function(w){return w.toLowerCase()},a=v==="next"?function(w){return w.toLowerCase()}:function(w){return w.toUpperCase()},u=v==="next"?ko:Do;var _=n.map(function(w){return{lower:a(w),upper:o(w)}}).sort(function(w,x){return u(w.lower,x.lower)});l=_.map(function(w){return w.upper}),h=_.map(function(w){return w.lower}),b=(y=v)==="next"?"":r}E("next"),e=new e.Collection(e,function(){return tt(l[0],h[f-1]+r)}),e._ondirectionchange=function(v){E(v)};var m=0;return e._addAlgorithm(function(v,_,w){var x=v.key;if(typeof x!="string")return!1;var A=a(x);if(t(A,h,m))return!0;for(var O=null,P=m;P<f;++P){var F=function(q,R,M,L,j,V){for(var te=Math.min(q.length,L.length),ce=-1,Z=0;Z<te;++Z){var we=R[Z];if(we!==L[Z])return j(q[Z],M[Z])<0?q.substr(0,Z)+M[Z]+M.substr(Z+1):j(q[Z],L[Z])<0?q.substr(0,Z)+L[Z]+M.substr(Z+1):0<=ce?q.substr(0,ce)+R[ce]+M.substr(ce+1):null;j(q[Z],we)<0&&(ce=Z)}return te<L.length&&V==="next"?q+M.substr(q.length):te<q.length&&V==="prev"?q.substr(0,M.length):ce<0?null:q.substr(0,ce)+L[ce]+M.substr(ce+1)}(x,A,l[P],h[P],u,y);F===null&&O===null?m=P+1:(O===null||0<u(O,F))&&(O=F)}return _(O!==null?function(){v.continue(O+b)}:w),!1}),e}function tt(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function kr(e){return{type:1,lower:e,upper:e}}var Dr=(Object.defineProperty(Ae.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Ae.prototype.between=function(e,t,n,r){n=n!==!1,r=r===!0;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(n||r)&&(!n||!r)?St(this):new this.Collection(this,function(){return tt(e,t,!n,!r)})}catch{return Me(this,Ye)}},Ae.prototype.equals=function(e){return e==null?Me(this,Ye):new this.Collection(this,function(){return kr(e)})},Ae.prototype.above=function(e){return e==null?Me(this,Ye):new this.Collection(this,function(){return tt(e,void 0,!0)})},Ae.prototype.aboveOrEqual=function(e){return e==null?Me(this,Ye):new this.Collection(this,function(){return tt(e,void 0,!1)})},Ae.prototype.below=function(e){return e==null?Me(this,Ye):new this.Collection(this,function(){return tt(void 0,e,!1,!0)})},Ae.prototype.belowOrEqual=function(e){return e==null?Me(this,Ye):new this.Collection(this,function(){return tt(void 0,e)})},Ae.prototype.startsWith=function(e){return typeof e!="string"?Me(this,Er):this.between(e,e+pt,!0,!0)},Ae.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):sn(this,function(t,n){return t.indexOf(n[0])===0},[e],pt)},Ae.prototype.equalsIgnoreCase=function(e){return sn(this,function(t,n){return t===n[0]},[e],"")},Ae.prototype.anyOfIgnoreCase=function(){var e=Re.apply(Ue,arguments);return e.length===0?St(this):sn(this,function(t,n){return n.indexOf(t)!==-1},e,"")},Ae.prototype.startsWithAnyOfIgnoreCase=function(){var e=Re.apply(Ue,arguments);return e.length===0?St(this):sn(this,function(t,n){return n.some(function(r){return t.indexOf(r)===0})},e,pt)},Ae.prototype.anyOf=function(){var e=this,t=Re.apply(Ue,arguments),n=this._cmp;try{t.sort(n)}catch{return Me(this,Ye)}if(t.length===0)return St(this);var r=new this.Collection(this,function(){return tt(t[0],t[t.length-1])});r._ondirectionchange=function(a){n=a==="next"?e._ascending:e._descending,t.sort(n)};var o=0;return r._addAlgorithm(function(a,u,l){for(var h=a.key;0<n(h,t[o]);)if(++o===t.length)return u(l),!1;return n(h,t[o])===0||(u(function(){a.continue(t[o])}),!1)}),r},Ae.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Ae.prototype.noneOf=function(){var e=Re.apply(Ue,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Me(this,Ye)}var t=e.reduce(function(n,r){return n?n.concat([[n[n.length-1][1],r]]):[[-1/0,r]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},Ae.prototype.inAnyRange=function(x,t){var n=this,r=this._cmp,o=this._ascending,a=this._descending,u=this._min,l=this._max;if(x.length===0)return St(this);if(!x.every(function(A){return A[0]!==void 0&&A[1]!==void 0&&o(A[0],A[1])<=0}))return Me(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",S.InvalidArgument);var h=!t||t.includeLowers!==!1,y=t&&t.includeUppers===!0,b,f=o;function E(A,O){return f(A[0],O[0])}try{(b=x.reduce(function(A,O){for(var P=0,F=A.length;P<F;++P){var q=A[P];if(r(O[0],q[1])<0&&0<r(O[1],q[0])){q[0]=u(q[0],O[0]),q[1]=l(q[1],O[1]);break}}return P===F&&A.push(O),A},[])).sort(E)}catch{return Me(this,Ye)}var m=0,v=y?function(A){return 0<o(A,b[m][1])}:function(A){return 0<=o(A,b[m][1])},_=h?function(A){return 0<a(A,b[m][0])}:function(A){return 0<=a(A,b[m][0])},w=v,x=new this.Collection(this,function(){return tt(b[0][0],b[b.length-1][1],!h,!y)});return x._ondirectionchange=function(A){f=A==="next"?(w=v,o):(w=_,a),b.sort(E)},x._addAlgorithm(function(A,O,P){for(var F,q=A.key;w(q);)if(++m===b.length)return O(P),!1;return!v(F=q)&&!_(F)||(n._cmp(q,b[m][1])===0||n._cmp(q,b[m][0])===0||O(function(){f===o?A.continue(b[m][0]):A.continue(b[m][1])}),!1)}),x},Ae.prototype.startsWithAnyOf=function(){var e=Re.apply(Ue,arguments);return e.every(function(t){return typeof t=="string"})?e.length===0?St(this):this.inAnyRange(e.map(function(t){return[t,t+pt]})):Me(this,"startsWithAnyOf() only works with strings")},Ae);function Ae(){}function Ve(e){return ge(function(t){return Kt(t),e(t.target.error),!1})}function Kt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var qt="storagemutated",Ln="x-storagemutated-1",nt=Bt(null,qt),Fo=(Ge.prototype._lock=function(){return W(!X.global),++this._reculock,this._reculock!==1||X.global||(X.lockOwnerFor=this),this},Ge.prototype._unlock=function(){if(W(!X.global),--this._reculock==0)for(X.global||(X.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{ft(e[1],e[0])}catch{}}return this},Ge.prototype._locked=function(){return this._reculock&&X.lockOwnerFor!==this},Ge.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(W(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new S.DatabaseClosed(r);case"MissingAPIError":throw new S.MissingAPI(r.message,r);default:throw new S.OpenFailed(r)}if(!this.active)throw new S.TransactionInactive;return W(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=ge(function(o){Kt(o),t._reject(e.error)}),e.onabort=ge(function(o){Kt(o),t.active&&t._reject(new S.Abort(e.error)),t.active=!1,t.on("abort").fire(o)}),e.oncomplete=ge(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&nt.storagemutated.fire(e.mutatedParts)}),this},Ge.prototype._promise=function(e,t,n){var r=this;if(e==="readwrite"&&this.mode!=="readwrite")return Ee(new S.ReadOnly("Transaction is readonly"));if(!this.active)return Ee(new S.TransactionInactive);if(this._locked())return new U(function(a,u){r._blockedFuncs.push([function(){r._promise(e,t,n).then(a,u)},X])});if(n)return Je(function(){var a=new U(function(u,l){r._lock();var h=t(u,l,r);h&&h.then&&h.then(u,l)});return a.finally(function(){return r._unlock()}),a._lib=!0,a});var o=new U(function(a,u){var l=t(a,u,r);l&&l.then&&l.then(a,u)});return o._lib=!0,o},Ge.prototype._root=function(){return this.parent?this.parent._root():this},Ge.prototype.waitFor=function(e){var t,n=this._root(),r=U.resolve(e);n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return r}):(n._waitingFor=r,n._waitingQueue=[],t=n.idbtrans.objectStore(n.storeNames[0]),function a(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(t.get(-1/0).onsuccess=a)}());var o=n._waitingFor;return new U(function(a,u){r.then(function(l){return n._waitingQueue.push(ge(a.bind(null,l)))},function(l){return n._waitingQueue.push(ge(u.bind(null,l)))}).finally(function(){n._waitingFor===o&&(n._waitingFor=null)})})},Ge.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new S.Abort))},Ge.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(G(t,e))return t[e];var n=this.schema[e];if(!n)throw new S.NotFound("Table "+e+" not part of transaction");return n=new this.db.Table(e,n,this),n.core=this.db.core.table(e),t[e]=n},Ge);function Ge(){}function Un(e,t,n,r,o,a,u,l){return{name:e,keyPath:t,unique:n,multi:r,auto:o,compound:a,src:(n&&!u?"&":"")+(r?"*":"")+(o?"++":"")+Fr(t),type:l}}function Fr(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function Vn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:(r=function(o){return[o.name,o]},n.reduce(function(o,a,u){return u=r(a,u),u&&(o[u[0]]=u[1]),o},{}))};var r}var jt=function(e){try{return e.only([[]]),jt=function(){return[[]]},[[]]}catch{return jt=function(){return pt},pt}};function Gn(e){return e==null?function(){}:typeof e=="string"?(t=e).split(".").length===1?function(n){return n[t]}:function(n){return le(n,t)}:function(n){return le(n,e)};var t}function Br(e){return[].slice.call(e)}var Bo=0;function Lt(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function Ro(e,t,h){function r(w){if(w.type===3)return null;if(w.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var m=w.lower,v=w.upper,_=w.lowerOpen,w=w.upperOpen;return m===void 0?v===void 0?null:t.upperBound(v,!!w):v===void 0?t.lowerBound(m,!!_):t.bound(m,v,!!_,!!w)}function o(E){var m,v=E.name;return{name:v,schema:E,mutate:function(_){var w=_.trans,x=_.type,A=_.keys,O=_.values,P=_.range;return new Promise(function(F,q){F=ge(F);var R=w.objectStore(v),M=R.keyPath==null,L=x==="put"||x==="add";if(!L&&x!=="delete"&&x!=="deleteRange")throw new Error("Invalid operation type: "+x);var j,V=(A||O||{length:1}).length;if(A&&O&&A.length!==O.length)throw new Error("Given keys array must have same length as given values array.");if(V===0)return F({numFailures:0,failures:{},results:[],lastResult:void 0});function te(Fe){++we,Kt(Fe)}var ce=[],Z=[],we=0;if(x==="deleteRange"){if(P.type===4)return F({numFailures:we,failures:Z,results:[],lastResult:void 0});P.type===3?ce.push(j=R.clear()):ce.push(j=R.delete(r(P)))}else{var M=L?M?[O,A]:[O,null]:[A,null],J=M[0],Ce=M[1];if(L)for(var ke=0;ke<V;++ke)ce.push(j=Ce&&Ce[ke]!==void 0?R[x](J[ke],Ce[ke]):R[x](J[ke])),j.onerror=te;else for(ke=0;ke<V;++ke)ce.push(j=R[x](J[ke])),j.onerror=te}function bn(Fe){Fe=Fe.target.result,ce.forEach(function(yt,ur){return yt.error!=null&&(Z[ur]=yt.error)}),F({numFailures:we,failures:Z,results:x==="delete"?A:ce.map(function(yt){return yt.result}),lastResult:Fe})}j.onerror=function(Fe){te(Fe),bn(Fe)},j.onsuccess=bn})},getMany:function(_){var w=_.trans,x=_.keys;return new Promise(function(A,O){A=ge(A);for(var P,F=w.objectStore(v),q=x.length,R=new Array(q),M=0,L=0,j=function(ce){ce=ce.target,R[ce._pos]=ce.result,++L===M&&A(R)},V=Ve(O),te=0;te<q;++te)x[te]!=null&&((P=F.get(x[te]))._pos=te,P.onsuccess=j,P.onerror=V,++M);M===0&&A(R)})},get:function(_){var w=_.trans,x=_.key;return new Promise(function(A,O){A=ge(A);var P=w.objectStore(v).get(x);P.onsuccess=function(F){return A(F.target.result)},P.onerror=Ve(O)})},query:(m=y,function(_){return new Promise(function(w,x){w=ge(w);var A,O,P,M=_.trans,F=_.values,q=_.limit,j=_.query,R=q===1/0?void 0:q,L=j.index,j=j.range,M=M.objectStore(v),L=L.isPrimaryKey?M:M.index(L.name),j=r(j);if(q===0)return w({result:[]});m?((R=F?L.getAll(j,R):L.getAllKeys(j,R)).onsuccess=function(V){return w({result:V.target.result})},R.onerror=Ve(x)):(A=0,O=!F&&"openKeyCursor"in L?L.openKeyCursor(j):L.openCursor(j),P=[],O.onsuccess=function(V){var te=O.result;return te?(P.push(F?te.value:te.primaryKey),++A===q?w({result:P}):void te.continue()):w({result:P})},O.onerror=Ve(x))})}),openCursor:function(_){var w=_.trans,x=_.values,A=_.query,O=_.reverse,P=_.unique;return new Promise(function(F,q){F=ge(F);var L=A.index,R=A.range,M=w.objectStore(v),M=L.isPrimaryKey?M:M.index(L.name),L=O?P?"prevunique":"prev":P?"nextunique":"next",j=!x&&"openKeyCursor"in M?M.openKeyCursor(r(R),L):M.openCursor(r(R),L);j.onerror=Ve(q),j.onsuccess=ge(function(V){var te,ce,Z,we,J=j.result;J?(J.___id=++Bo,J.done=!1,te=J.continue.bind(J),ce=(ce=J.continuePrimaryKey)&&ce.bind(J),Z=J.advance.bind(J),we=function(){throw new Error("Cursor not stopped")},J.trans=w,J.stop=J.continue=J.continuePrimaryKey=J.advance=function(){throw new Error("Cursor not started")},J.fail=ge(q),J.next=function(){var Ce=this,ke=1;return this.start(function(){return ke--?Ce.continue():Ce.stop()}).then(function(){return Ce})},J.start=function(Ce){function ke(){if(j.result)try{Ce()}catch(Fe){J.fail(Fe)}else J.done=!0,J.start=function(){throw new Error("Cursor behind last entry")},J.stop()}var bn=new Promise(function(Fe,yt){Fe=ge(Fe),j.onerror=Ve(yt),J.fail=yt,J.stop=function(ur){J.stop=J.continue=J.continuePrimaryKey=J.advance=we,Fe(ur)}});return j.onsuccess=ge(function(Fe){j.onsuccess=ke,ke()}),J.continue=te,J.continuePrimaryKey=ce,J.advance=Z,ke(),bn},F(J)):F(null)},q)})},count:function(_){var w=_.query,x=_.trans,A=w.index,O=w.range;return new Promise(function(P,F){var q=x.objectStore(v),R=A.isPrimaryKey?q:q.index(A.name),q=r(O),R=q?R.count(q):R.count();R.onsuccess=ge(function(M){return P(M.target.result)}),R.onerror=Ve(F)})}}}var a,u,l,b=(u=h,l=Br((a=e).objectStoreNames),{schema:{name:a.name,tables:l.map(function(E){return u.objectStore(E)}).map(function(E){var m=E.keyPath,w=E.autoIncrement,v=D(m),_={},w={name:E.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:m==null,compound:v,keyPath:m,autoIncrement:w,unique:!0,extractKey:Gn(m)},indexes:Br(E.indexNames).map(function(x){return E.index(x)}).map(function(P){var A=P.name,O=P.unique,F=P.multiEntry,P=P.keyPath,F={name:A,compound:D(P),keyPath:P,unique:O,multiEntry:F,extractKey:Gn(P)};return _[Lt(P)]=F}),getIndexByKeyPath:function(x){return _[Lt(x)]}};return _[":id"]=w.primaryKey,m!=null&&(_[Lt(m)]=w.primaryKey),w})},hasGetAll:0<l.length&&"getAll"in u.objectStore(l[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),h=b.schema,y=b.hasGetAll,b=h.tables.map(o),f={};return b.forEach(function(E){return f[E.name]=E}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(E){if(!f[E])throw new Error("Table '".concat(E,"' not found"));return f[E]},MIN_KEY:-1/0,MAX_KEY:jt(t),schema:h}}function Mo(e,t,n,r){var o=n.IDBKeyRange;return n.indexedDB,{dbcore:(r=Ro(t,o,r),e.dbcore.reduce(function(a,u){return u=u.create,d(d({},a),u(a))},r))}}function un(e,r){var n=r.db,r=Mo(e._middlewares,n,e._deps,r);e.core=r.dbcore,e.tables.forEach(function(o){var a=o.name;e.core.schema.tables.some(function(u){return u.name===a})&&(o.core=e.core.table(a),e[a]instanceof e.Table&&(e[a].core=o.core))})}function cn(e,t,n,r){n.forEach(function(o){var a=r[o];t.forEach(function(u){var l=function h(y,b){return Q(y,b)||(y=$(y))&&h(y,b)}(u,o);(!l||"value"in l&&l.value===void 0)&&(u===e.Transaction.prototype||u instanceof e.Transaction?K(u,o,{get:function(){return this.table(o)},set:function(h){se(this,o,{value:h,writable:!0,configurable:!0,enumerable:!0})}}):u[o]=new e.Table(o,a))})})}function Wn(e,t){t.forEach(function(n){for(var r in n)n[r]instanceof e.Table&&delete n[r]})}function Ko(e,t){return e._cfg.version-t._cfg.version}function qo(e,t,n,r){var o=e._dbSchema;n.objectStoreNames.contains("$meta")&&!o.$meta&&(o.$meta=Vn("$meta",Mr("")[0],[]),e._storeNames.push("$meta"));var a=e._createTransaction("readwrite",e._storeNames,o);a.create(n),a._completion.catch(r);var u=a._reject.bind(a),l=X.transless||X;Je(function(){return X.trans=a,X.transless=l,t!==0?(un(e,n),y=t,((h=a).storeNames.includes("$meta")?h.table("$meta").get("version").then(function(b){return b??y}):U.resolve(y)).then(function(b){return E=b,m=a,v=n,_=[],b=(f=e)._versions,w=f._dbSchema=fn(0,f.idbdb,v),(b=b.filter(function(x){return x._cfg.version>=E})).length!==0?(b.forEach(function(x){_.push(function(){var A=w,O=x._cfg.dbschema;pn(f,A,v),pn(f,O,v),w=f._dbSchema=O;var P=Yn(A,O);P.add.forEach(function(L){Xn(v,L[0],L[1].primKey,L[1].indexes)}),P.change.forEach(function(L){if(L.recreate)throw new S.Upgrade("Not yet support for changing primary key");var j=v.objectStore(L.name);L.add.forEach(function(V){return ln(j,V)}),L.change.forEach(function(V){j.deleteIndex(V.name),ln(j,V)}),L.del.forEach(function(V){return j.deleteIndex(V)})});var F=x._cfg.contentUpgrade;if(F&&x._cfg.version>E){un(f,v),m._memoizedTables={};var q=Oe(O);P.del.forEach(function(L){q[L]=A[L]}),Wn(f,[f.Transaction.prototype]),cn(f,[f.Transaction.prototype],B(q),q),m.schema=q;var R,M=qe(F);return M&&Et(),P=U.follow(function(){var L;(R=F(m))&&M&&(L=Ze.bind(null,null),R.then(L,L))}),R&&typeof R.then=="function"?U.resolve(R):P.then(function(){return R})}}),_.push(function(A){var O,P,F=x._cfg.dbschema;O=F,P=A,[].slice.call(P.db.objectStoreNames).forEach(function(q){return O[q]==null&&P.db.deleteObjectStore(q)}),Wn(f,[f.Transaction.prototype]),cn(f,[f.Transaction.prototype],f._storeNames,f._dbSchema),m.schema=f._dbSchema}),_.push(function(A){f.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(f.idbdb.version/10)===x._cfg.version?(f.idbdb.deleteObjectStore("$meta"),delete f._dbSchema.$meta,f._storeNames=f._storeNames.filter(function(O){return O!=="$meta"})):A.objectStore("$meta").put(x._cfg.version,"version"))})}),function x(){return _.length?U.resolve(_.shift()(m.idbtrans)).then(x):U.resolve()}().then(function(){Rr(w,v)})):U.resolve();var f,E,m,v,_,w}).catch(u)):(B(o).forEach(function(b){Xn(n,b,o[b].primKey,o[b].indexes)}),un(e,n),void U.follow(function(){return e.on.populate.fire(a)}).catch(u));var h,y})}function jo(e,t){Rr(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=fn(0,e.idbdb,t);pn(e,e._dbSchema,t);for(var r=0,o=Yn(n,e._dbSchema).change;r<o.length;r++){var a=function(u){if(u.change.length||u.recreate)return console.warn("Unable to patch indexes of table ".concat(u.name," because it has changes on the type of index or primary key.")),{value:void 0};var l=t.objectStore(u.name);u.add.forEach(function(h){Be&&console.debug("Dexie upgrade patch: Creating missing index ".concat(u.name,".").concat(h.src)),ln(l,h)})}(o[r]);if(typeof a=="object")return a.value}}function Yn(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var o=e[n],a=t[n];if(o){var u={name:n,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(o.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||o.primKey.auto!==a.primKey.auto)u.recreate=!0,r.change.push(u);else{var l=o.idxByName,h=a.idxByName,y=void 0;for(y in l)h[y]||u.del.push(y);for(y in h){var b=l[y],f=h[y];b?b.src!==f.src&&u.change.push(f):u.add.push(f)}(0<u.del.length||0<u.add.length||0<u.change.length)&&r.change.push(u)}}else r.add.push([n,a])}return r}function Xn(e,t,n,r){var o=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(a){return ln(o,a)}),o}function Rr(e,t){B(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(Be&&console.debug("Dexie: Creating missing table",n),Xn(t,n,e[n].primKey,e[n].indexes))})}function ln(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function fn(e,t,n){var r={};return _e(t.objectStoreNames,0).forEach(function(o){for(var a=n.objectStore(o),u=Un(Fr(y=a.keyPath),y||"",!0,!1,!!a.autoIncrement,y&&typeof y!="string",!0),l=[],h=0;h<a.indexNames.length;++h){var b=a.index(a.indexNames[h]),y=b.keyPath,b=Un(b.name,y,!!b.unique,!!b.multiEntry,!1,y&&typeof y!="string",!1);l.push(b)}r[o]=Vn(o,u,l)}),r}function pn(e,t,n){for(var r=n.db.objectStoreNames,o=0;o<r.length;++o){var a=r[o],u=n.objectStore(a);e._hasGetAll="getAll"in u;for(var l=0;l<u.indexNames.length;++l){var h=u.indexNames[l],y=u.index(h).keyPath,b=typeof y=="string"?y:"["+_e(y).join("+")+"]";!t[a]||(y=t[a].idxByName[b])&&(y.name=h,delete t[a].idxByName[b],t[a].idxByName[h]=y)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&k.WorkerGlobalScope&&k instanceof k.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function Mr(e){return e.split(",").map(function(t,n){var a=t.split(":"),r=(o=a[1])===null||o===void 0?void 0:o.trim(),o=(t=a[0].trim()).replace(/([&*]|\+\+)/g,""),a=/^\[/.test(o)?o.match(/^\[(.*)\]$/)[1].split("+"):o;return Un(o,a||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),D(a),n===0,r)})}var Lo=(Nt.prototype._createTableSchema=Vn,Nt.prototype._parseIndexSyntax=Mr,Nt.prototype._parseStoresSpec=function(e,t){var n=this;B(e).forEach(function(r){if(e[r]!==null){var o=n._parseIndexSyntax(e[r]),a=o.shift();if(!a)throw new S.Schema("Invalid schema for table "+r+": "+e[r]);if(a.unique=!0,a.multi)throw new S.Schema("Primary key cannot be multiEntry*");o.forEach(function(u){if(u.auto)throw new S.Schema("Only primary key can be marked as autoIncrement (++)");if(!u.keyPath)throw new S.Schema("Index must have a name and cannot be an empty string")}),o=n._createTableSchema(r,a,o),t[r]=o}})},Nt.prototype.stores=function(n){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?Y(this._cfg.storesSource,n):n;var n=t._versions,r={},o={};return n.forEach(function(a){Y(r,a._cfg.storesSource),o=a._cfg.dbschema={},a._parseStoresSpec(r,o)}),t._dbSchema=o,Wn(t,[t._allTables,t,t.Transaction.prototype]),cn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],B(o),o),t._storeNames=B(o),this},Nt.prototype.upgrade=function(e){return this._cfg.contentUpgrade=bt(this._cfg.contentUpgrade||H,e),this},Nt);function Nt(){}function $n(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Xe(tn,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function zn(e){return e&&typeof e.databases=="function"}function Hn(e){return Je(function(){return X.letThrough=!0,e()})}function Qn(e){return!("from"in e)}var Ie=function(e,t){if(!this){var n=new Ie;return e&&"d"in e&&Y(n,e),n}Y(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function Ut(e,t,n){var r=ie(t,n);if(!isNaN(r)){if(0<r)throw RangeError();if(Qn(e))return Y(e,{from:t,to:n,d:1});var o=e.l,r=e.r;if(ie(n,e.from)<0)return o?Ut(o,t,n):e.l={from:t,to:n,d:1,l:null,r:null},qr(e);if(0<ie(t,e.to))return r?Ut(r,t,n):e.r={from:t,to:n,d:1,l:null,r:null},qr(e);ie(t,e.from)<0&&(e.from=t,e.l=null,e.d=r?r.d+1:1),0<ie(n,e.to)&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1),n=!e.r,o&&!e.l&&Vt(e,o),r&&n&&Vt(e,r)}}function Vt(e,t){Qn(t)||function n(r,h){var a=h.from,u=h.to,l=h.l,h=h.r;Ut(r,a,u),l&&n(r,l),h&&n(r,h)}(e,t)}function Kr(e,t){var n=dn(t),r=n.next();if(r.done)return!1;for(var o=r.value,a=dn(e),u=a.next(o.from),l=u.value;!r.done&&!u.done;){if(ie(l.from,o.to)<=0&&0<=ie(l.to,o.from))return!0;ie(o.from,l.from)<0?o=(r=n.next(l.from)).value:l=(u=a.next(o.from)).value}return!1}function dn(e){var t=Qn(e)?null:{s:0,n:e};return{next:function(n){for(var r=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&ie(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||ie(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function qr(e){var t,n,r=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((n=e.l)===null||n===void 0?void 0:n.d)||0),o=1<r?"r":r<-1?"l":"";o&&(t=o=="r"?"l":"r",n=d({},e),r=e[o],e.from=r.from,e.to=r.to,e[o]=r[o],n[o]=r[t],(e[t]=n).d=jr(n)),e.d=jr(e)}function jr(n){var t=n.r,n=n.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function hn(e,t){return B(t).forEach(function(n){e[n]?Vt(e[n],t[n]):e[n]=function r(o){var a,u,l={};for(a in o)G(o,a)&&(u=o[a],l[a]=!u||typeof u!="object"||Le.has(u.constructor)?u:r(u));return l}(t[n])}),e}function Jn(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&Kr(t[n],e[n])})}de(Ie.prototype,((Ke={add:function(e){return Vt(this,e),this},addKey:function(e){return Ut(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(n){return Ut(t,n,n)}),this},hasKey:function(e){var t=dn(this).next(e).value;return t&&ie(t.from,e)<=0&&0<=ie(t.to,e)}})[Se]=function(){return dn(this)},Ke));var ht={},Zn={},er=!1;function mn(e){hn(Zn,e),er||(er=!0,setTimeout(function(){er=!1,tr(Zn,!(Zn={}))},0))}function tr(e,t){t===void 0&&(t=!1);var n=new Set;if(e.all)for(var r=0,o=Object.values(ht);r<o.length;r++)Lr(u=o[r],e,n,t);else for(var a in e){var u,l=/^idb\:\/\/(.*)\/(.*)\//.exec(a);l&&(a=l[1],l=l[2],(u=ht["idb://".concat(a,"/").concat(l)])&&Lr(u,e,n,t))}n.forEach(function(h){return h()})}function Lr(e,t,n,r){for(var o=[],a=0,u=Object.entries(e.queries.query);a<u.length;a++){for(var l=u[a],h=l[0],y=[],b=0,f=l[1];b<f.length;b++){var E=f[b];Jn(t,E.obsSet)?E.subscribers.forEach(function(w){return n.add(w)}):r&&y.push(E)}r&&o.push([h,y])}if(r)for(var m=0,v=o;m<v.length;m++){var _=v[m],h=_[0],y=_[1];e.queries.query[h]=y}}function Uo(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?Ee(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller,o=Math.round(10*e.verno),a=!1;function u(){if(t.openCanceller!==r)throw new S.DatabaseClosed("db.open() was cancelled")}function l(){return new U(function(E,m){if(u(),!n)throw new S.MissingAPI;var v=e.name,_=t.autoSchema||!o?n.open(v):n.open(v,o);if(!_)throw new S.MissingAPI;_.onerror=Ve(m),_.onblocked=ge(e._fireOnBlocked),_.onupgradeneeded=ge(function(w){var x;b=_.transaction,t.autoSchema&&!e._options.allowEmptyDB?(_.onerror=Kt,b.abort(),_.result.close(),(x=n.deleteDatabase(v)).onsuccess=x.onerror=ge(function(){m(new S.NoSuchDatabase("Database ".concat(v," doesnt exist")))})):(b.onerror=Ve(m),w=w.oldVersion>Math.pow(2,62)?0:w.oldVersion,f=w<1,e.idbdb=_.result,a&&jo(e,b),qo(e,w/10,b,m))},m),_.onsuccess=ge(function(){b=null;var w,x,A,O,P,F=e.idbdb=_.result,q=_e(F.objectStoreNames);if(0<q.length)try{var R=F.transaction((O=q).length===1?O[0]:O,"readonly");if(t.autoSchema)x=F,A=R,(w=e).verno=x.version/10,A=w._dbSchema=fn(0,x,A),w._storeNames=_e(x.objectStoreNames,0),cn(w,[w._allTables],B(A),A);else if(pn(e,e._dbSchema,R),((P=Yn(fn(0,(P=e).idbdb,R),P._dbSchema)).add.length||P.change.some(function(M){return M.add.length||M.change.length}))&&!a)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),F.close(),o=F.version+1,a=!0,E(l());un(e,R)}catch{}Tt.push(e),F.onversionchange=ge(function(M){t.vcFired=!0,e.on("versionchange").fire(M)}),F.onclose=ge(function(M){e.on("close").fire(M)}),f&&(P=e._deps,R=v,F=P.indexedDB,P=P.IDBKeyRange,zn(F)||R===tn||$n(F,P).put({name:R}).catch(H)),E()},m)}).catch(function(E){switch(E?.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),l();break;case"VersionError":if(0<o)return o=0,l()}return U.reject(E)})}var h,y=t.dbReadyResolve,b=null,f=!1;return U.race([r,(typeof navigator>"u"?U.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(E){function m(){return indexedDB.databases().finally(E)}h=setInterval(m,100),m()}).finally(function(){return clearInterval(h)}):Promise.resolve()).then(l)]).then(function(){return u(),t.onReadyBeingFired=[],U.resolve(Hn(function(){return e.on.ready.fire(e.vip)})).then(function E(){if(0<t.onReadyBeingFired.length){var m=t.onReadyBeingFired.reduce(bt,H);return t.onReadyBeingFired=[],U.resolve(Hn(function(){return m(e.vip)})).then(E)}})}).finally(function(){t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(E){t.dbOpenError=E;try{b&&b.abort()}catch{}return r===t.openCanceller&&e._close(),Ee(E)}).finally(function(){t.openComplete=!0,y()}).then(function(){var E;return f&&(E={},e.tables.forEach(function(m){m.schema.indexes.forEach(function(v){v.name&&(E["idb://".concat(e.name,"/").concat(m.name,"/").concat(v.name)]=new Ie(-1/0,[[[]]]))}),E["idb://".concat(e.name,"/").concat(m.name,"/")]=E["idb://".concat(e.name,"/").concat(m.name,"/:dels")]=new Ie(-1/0,[[[]]])}),nt(qt).fire(E),tr(E,!0)),e})}function nr(e){function t(a){return e.next(a)}var n=o(t),r=o(function(a){return e.throw(a)});function o(a){return function(h){var l=a(h),h=l.value;return l.done?h:h&&typeof h.then=="function"?h.then(n,r):D(h)?Promise.all(h).then(n,r):n(h)}}return o(t)()}function yn(e,t,n){for(var r=D(e)?e.slice():[e],o=0;o<n;++o)r.push(t);return r}var Vo={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return d(d({},e),{table:function(t){var n=e.table(t),r=n.schema,o={},a=[];function u(f,E,m){var v=Lt(f),_=o[v]=o[v]||[],w=f==null?0:typeof f=="string"?1:f.length,x=0<E,x=d(d({},m),{name:x?"".concat(v,"(virtual-from:").concat(m.name,")"):m.name,lowLevelIndex:m,isVirtual:x,keyTail:E,keyLength:w,extractKey:Gn(f),unique:!x&&m.unique});return _.push(x),x.isPrimaryKey||a.push(x),1<w&&u(w===2?f[0]:f.slice(0,w-1),E+1,m),_.sort(function(A,O){return A.keyTail-O.keyTail}),x}t=u(r.primaryKey.keyPath,0,r.primaryKey),o[":id"]=[t];for(var l=0,h=r.indexes;l<h.length;l++){var y=h[l];u(y.keyPath,0,y)}function b(f){var E,m=f.query.index;return m.isVirtual?d(d({},f),{query:{index:m.lowLevelIndex,range:(E=f.query.range,m=m.keyTail,{type:E.type===1?2:E.type,lower:yn(E.lower,E.lowerOpen?e.MAX_KEY:e.MIN_KEY,m),lowerOpen:!0,upper:yn(E.upper,E.upperOpen?e.MIN_KEY:e.MAX_KEY,m),upperOpen:!0})}}):f}return d(d({},n),{schema:d(d({},r),{primaryKey:t,indexes:a,getIndexByKeyPath:function(f){return(f=o[Lt(f)])&&f[0]}}),count:function(f){return n.count(b(f))},query:function(f){return n.query(b(f))},openCursor:function(f){var E=f.query.index,m=E.keyTail,v=E.isVirtual,_=E.keyLength;return v?n.openCursor(b(f)).then(function(x){return x&&w(x)}):n.openCursor(f);function w(x){return Object.create(x,{continue:{value:function(A){A!=null?x.continue(yn(A,f.reverse?e.MAX_KEY:e.MIN_KEY,m)):f.unique?x.continue(x.key.slice(0,_).concat(f.reverse?e.MIN_KEY:e.MAX_KEY,m)):x.continue()}},continuePrimaryKey:{value:function(A,O){x.continuePrimaryKey(yn(A,e.MAX_KEY,m),O)}},primaryKey:{get:function(){return x.primaryKey}},key:{get:function(){var A=x.key;return _===1?A[0]:A.slice(0,_)}},value:{get:function(){return x.value}}})}}})}})}};function rr(e,t,n,r){return n=n||{},r=r||"",B(e).forEach(function(o){var a,u,l;G(t,o)?(a=e[o],u=t[o],typeof a=="object"&&typeof u=="object"&&a&&u?(l=me(a))!==me(u)?n[r+o]=t[o]:l==="Object"?rr(a,u,n,r+o+"."):a!==u&&(n[r+o]=t[o]):a!==u&&(n[r+o]=t[o])):n[r+o]=void 0}),B(t).forEach(function(o){G(e,o)||(n[r+o]=t[o])}),n}function or(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var Go={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return d(d({},e),{table:function(t){var n=e.table(t),r=n.schema.primaryKey;return d(d({},n),{mutate:function(o){var a=X.trans,u=a.table(t).hook,l=u.deleting,h=u.creating,y=u.updating;switch(o.type){case"add":if(h.fire===H)break;return a._promise("readwrite",function(){return b(o)},!0);case"put":if(h.fire===H&&y.fire===H)break;return a._promise("readwrite",function(){return b(o)},!0);case"delete":if(l.fire===H)break;return a._promise("readwrite",function(){return b(o)},!0);case"deleteRange":if(l.fire===H)break;return a._promise("readwrite",function(){return function f(E,m,v){return n.query({trans:E,values:!1,query:{index:r,range:m},limit:v}).then(function(_){var w=_.result;return b({type:"delete",keys:w,trans:E}).then(function(x){return 0<x.numFailures?Promise.reject(x.failures[0]):w.length<v?{failures:[],numFailures:0,lastResult:void 0}:f(E,d(d({},m),{lower:w[w.length-1],lowerOpen:!0}),v)})})}(o.trans,o.range,1e4)},!0)}return n.mutate(o);function b(f){var E,m,v,_=X.trans,w=f.keys||or(r,f);if(!w)throw new Error("Keys missing");return(f=f.type==="add"||f.type==="put"?d(d({},f),{keys:w}):d({},f)).type!=="delete"&&(f.values=I([],f.values)),f.keys&&(f.keys=I([],f.keys)),E=n,v=w,((m=f).type==="add"?Promise.resolve([]):E.getMany({trans:m.trans,keys:v,cache:"immutable"})).then(function(x){var A=w.map(function(O,P){var F,q,R,M=x[P],L={onerror:null,onsuccess:null};return f.type==="delete"?l.fire.call(L,O,M,_):f.type==="add"||M===void 0?(F=h.fire.call(L,O,f.values[P],_),O==null&&F!=null&&(f.keys[P]=O=F,r.outbound||re(f.values[P],r.keyPath,O))):(F=rr(M,f.values[P]),(q=y.fire.call(L,F,O,M,_))&&(R=f.values[P],Object.keys(q).forEach(function(j){G(R,j)?R[j]=q[j]:re(R,j,q[j])}))),L});return n.mutate(f).then(function(O){for(var P=O.failures,F=O.results,q=O.numFailures,O=O.lastResult,R=0;R<w.length;++R){var M=(F||w)[R],L=A[R];M==null?L.onerror&&L.onerror(P[R]):L.onsuccess&&L.onsuccess(f.type==="put"&&x[R]?f.values[R]:M)}return{failures:P,results:F,numFailures:q,lastResult:O}}).catch(function(O){return A.forEach(function(P){return P.onerror&&P.onerror(O)}),Promise.reject(O)})})}}})}})}};function Ur(e,t,n){try{if(!t||t.keys.length<e.length)return null;for(var r=[],o=0,a=0;o<t.keys.length&&a<e.length;++o)ie(t.keys[o],e[a])===0&&(r.push(n?De(t.values[o]):t.values[o]),++a);return r.length===e.length?r:null}catch{return null}}var Wo={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return d(d({},n),{getMany:function(r){if(!r.cache)return n.getMany(r);var o=Ur(r.keys,r.trans._cache,r.cache==="clone");return o?U.resolve(o):n.getMany(r).then(function(a){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?De(a):a},a})},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}};function Vr(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function Gr(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Yo={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,n=new Ie(e.MIN_KEY,e.MAX_KEY);return d(d({},e),{transaction:function(r,o,a){if(X.subscr&&o!=="readonly")throw new S.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(X.querier));return e.transaction(r,o,a)},table:function(r){var o=e.table(r),a=o.schema,u=a.primaryKey,f=a.indexes,l=u.extractKey,h=u.outbound,y=u.autoIncrement&&f.filter(function(m){return m.compound&&m.keyPath.includes(u.keyPath)}),b=d(d({},o),{mutate:function(m){function v(j){return j="idb://".concat(t,"/").concat(r,"/").concat(j),O[j]||(O[j]=new Ie)}var _,w,x,A=m.trans,O=m.mutatedParts||(m.mutatedParts={}),P=v(""),F=v(":dels"),q=m.type,L=m.type==="deleteRange"?[m.range]:m.type==="delete"?[m.keys]:m.values.length<50?[or(u,m).filter(function(j){return j}),m.values]:[],R=L[0],M=L[1],L=m.trans._cache;return D(R)?(P.addKeys(R),(L=q==="delete"||R.length===M.length?Ur(R,L):null)||F.addKeys(R),(L||M)&&(_=v,w=L,x=M,a.indexes.forEach(function(j){var V=_(j.name||"");function te(Z){return Z!=null?j.extractKey(Z):null}function ce(Z){return j.multiEntry&&D(Z)?Z.forEach(function(we){return V.addKey(we)}):V.addKey(Z)}(w||x).forEach(function(Z,Ce){var J=w&&te(w[Ce]),Ce=x&&te(x[Ce]);ie(J,Ce)!==0&&(J!=null&&ce(J),Ce!=null&&ce(Ce))})}))):R?(M={from:(M=R.lower)!==null&&M!==void 0?M:e.MIN_KEY,to:(M=R.upper)!==null&&M!==void 0?M:e.MAX_KEY},F.add(M),P.add(M)):(P.add(n),F.add(n),a.indexes.forEach(function(j){return v(j.name).add(n)})),o.mutate(m).then(function(j){return!R||m.type!=="add"&&m.type!=="put"||(P.addKeys(j.results),y&&y.forEach(function(V){for(var te=m.values.map(function(J){return V.extractKey(J)}),ce=V.keyPath.findIndex(function(J){return J===u.keyPath}),Z=0,we=j.results.length;Z<we;++Z)te[Z][ce]=j.results[Z];v(V.name).addKeys(te)})),A.mutatedParts=hn(A.mutatedParts||{},O),j})}}),f=function(v){var _=v.query,v=_.index,_=_.range;return[v,new Ie((v=_.lower)!==null&&v!==void 0?v:e.MIN_KEY,(_=_.upper)!==null&&_!==void 0?_:e.MAX_KEY)]},E={get:function(m){return[u,new Ie(m.key)]},getMany:function(m){return[u,new Ie().addKeys(m.keys)]},count:f,query:f,openCursor:f};return B(E).forEach(function(m){b[m]=function(v){var _=X.subscr,w=!!_,x=Vr(X,o)&&Gr(m,v)?v.obsSet={}:_;if(w){var A=function(M){return M="idb://".concat(t,"/").concat(r,"/").concat(M),x[M]||(x[M]=new Ie)},O=A(""),P=A(":dels"),_=E[m](v),w=_[0],_=_[1];if((m==="query"&&w.isPrimaryKey&&!v.values?P:A(w.name||"")).add(_),!w.isPrimaryKey){if(m!=="count"){var F=m==="query"&&h&&v.values&&o.query(d(d({},v),{values:!1}));return o[m].apply(this,arguments).then(function(M){if(m==="query"){if(h&&v.values)return F.then(function(te){return te=te.result,O.addKeys(te),M});var L=v.values?M.result.map(l):M.result;(v.values?O:P).addKeys(L)}else if(m==="openCursor"){var j=M,V=v.values;return j&&Object.create(j,{key:{get:function(){return P.addKey(j.primaryKey),j.key}},primaryKey:{get:function(){var te=j.primaryKey;return P.addKey(te),te}},value:{get:function(){return V&&O.addKey(j.primaryKey),j.value}}})}return M})}P.add(n)}}return o[m].apply(this,arguments)}}),b}})}};function Wr(e,t,n){if(n.numFailures===0)return t;if(t.type==="deleteRange")return null;var r=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;return n.numFailures===r?null:(t=d({},t),D(t.keys)&&(t.keys=t.keys.filter(function(o,a){return!(a in n.failures)})),"values"in t&&D(t.values)&&(t.values=t.values.filter(function(o,a){return!(a in n.failures)})),t)}function ar(e,t){return n=e,((r=t).lower===void 0||(r.lowerOpen?0<ie(n,r.lower):0<=ie(n,r.lower)))&&(e=e,(t=t).upper===void 0||(t.upperOpen?ie(e,t.upper)<0:ie(e,t.upper)<=0));var n,r}function Yr(e,t,E,r,o,a){if(!E||E.length===0)return e;var u=t.query.index,l=u.multiEntry,h=t.query.range,y=r.schema.primaryKey.extractKey,b=u.extractKey,f=(u.lowLevelIndex||u).extractKey,E=E.reduce(function(m,v){var _=m,w=[];if(v.type==="add"||v.type==="put")for(var x=new Ie,A=v.values.length-1;0<=A;--A){var O,P=v.values[A],F=y(P);x.hasKey(F)||(O=b(P),(l&&D(O)?O.some(function(j){return ar(j,h)}):ar(O,h))&&(x.addKey(F),w.push(P)))}switch(v.type){case"add":var q=new Ie().addKeys(t.values?m.map(function(V){return y(V)}):m),_=m.concat(t.values?w.filter(function(V){return V=y(V),!q.hasKey(V)&&(q.addKey(V),!0)}):w.map(function(V){return y(V)}).filter(function(V){return!q.hasKey(V)&&(q.addKey(V),!0)}));break;case"put":var R=new Ie().addKeys(v.values.map(function(V){return y(V)}));_=m.filter(function(V){return!R.hasKey(t.values?y(V):V)}).concat(t.values?w:w.map(function(V){return y(V)}));break;case"delete":var M=new Ie().addKeys(v.keys);_=m.filter(function(V){return!M.hasKey(t.values?y(V):V)});break;case"deleteRange":var L=v.range;_=m.filter(function(V){return!ar(y(V),L)})}return _},e);return E===e?e:(E.sort(function(m,v){return ie(f(m),f(v))||ie(y(m),y(v))}),t.limit&&t.limit<1/0&&(E.length>t.limit?E.length=t.limit:e.length===t.limit&&E.length<t.limit&&(o.dirty=!0)),a?Object.freeze(E):E)}function Xr(e,t){return ie(e.lower,t.lower)===0&&ie(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function Xo(e,t){return function(n,r,o,a){if(n===void 0)return r!==void 0?-1:0;if(r===void 0)return 1;if((r=ie(n,r))===0){if(o&&a)return 0;if(o)return 1;if(a)return-1}return r}(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=function(n,r,o,a){if(n===void 0)return r!==void 0?1:0;if(r===void 0)return-1;if((r=ie(n,r))===0){if(o&&a)return 0;if(o)return-1;if(a)return 1}return r}(e.upper,t.upper,e.upperOpen,t.upperOpen)}function $o(e,t,n,r){e.subscribers.add(n),r.addEventListener("abort",function(){var o,a;e.subscribers.delete(n),e.subscribers.size===0&&(o=e,a=t,setTimeout(function(){o.subscribers.size===0&&We(a,o)},3e3))})}var zo={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return d(d({},e),{transaction:function(n,r,o){var a,u,l=e.transaction(n,r,o);return r==="readwrite"&&(u=(a=new AbortController).signal,o=function(h){return function(){if(a.abort(),r==="readwrite"){for(var y=new Set,b=0,f=n;b<f.length;b++){var E=f[b],m=ht["idb://".concat(t,"/").concat(E)];if(m){var v=e.table(E),_=m.optimisticOps.filter(function(V){return V.trans===l});if(l._explicit&&h&&l.mutatedParts)for(var w=0,x=Object.values(m.queries.query);w<x.length;w++)for(var A=0,O=(q=x[w]).slice();A<O.length;A++)Jn((R=O[A]).obsSet,l.mutatedParts)&&(We(q,R),R.subscribers.forEach(function(V){return y.add(V)}));else if(0<_.length){m.optimisticOps=m.optimisticOps.filter(function(V){return V.trans!==l});for(var P=0,F=Object.values(m.queries.query);P<F.length;P++)for(var q,R,M,L=0,j=(q=F[P]).slice();L<j.length;L++)(R=j[L]).res!=null&&l.mutatedParts&&(h&&!R.dirty?(M=Object.isFrozen(R.res),M=Yr(R.res,R.req,_,v,R,M),R.dirty?(We(q,R),R.subscribers.forEach(function(V){return y.add(V)})):M!==R.res&&(R.res=M,R.promise=U.resolve({result:M}))):(R.dirty&&We(q,R),R.subscribers.forEach(function(V){return y.add(V)})))}}}y.forEach(function(V){return V()})}}},l.addEventListener("abort",o(!1),{signal:u}),l.addEventListener("error",o(!1),{signal:u}),l.addEventListener("complete",o(!0),{signal:u})),l},table:function(n){var r=e.table(n),o=r.schema.primaryKey;return d(d({},r),{mutate:function(a){var u=X.trans;if(o.outbound||u.db._options.cache==="disabled"||u.explicit||u.idbtrans.mode!=="readwrite")return r.mutate(a);var l=ht["idb://".concat(t,"/").concat(n)];return l?(u=r.mutate(a),a.type!=="add"&&a.type!=="put"||!(50<=a.values.length||or(o,a).some(function(h){return h==null}))?(l.optimisticOps.push(a),a.mutatedParts&&mn(a.mutatedParts),u.then(function(h){0<h.numFailures&&(We(l.optimisticOps,a),(h=Wr(0,a,h))&&l.optimisticOps.push(h),a.mutatedParts&&mn(a.mutatedParts))}),u.catch(function(){We(l.optimisticOps,a),a.mutatedParts&&mn(a.mutatedParts)})):u.then(function(h){var y=Wr(0,d(d({},a),{values:a.values.map(function(b,f){var E;return h.failures[f]||(b=(E=o.keyPath)!==null&&E!==void 0&&E.includes(".")?De(b):d({},b),re(b,o.keyPath,h.results[f])),b})}),h);l.optimisticOps.push(y),queueMicrotask(function(){return a.mutatedParts&&mn(a.mutatedParts)})}),u):r.mutate(a)},query:function(a){if(!Vr(X,r)||!Gr("query",a))return r.query(a);var u=((y=X.trans)===null||y===void 0?void 0:y.db._options.cache)==="immutable",f=X,l=f.requery,h=f.signal,y=function(v,_,w,x){var A=ht["idb://".concat(v,"/").concat(_)];if(!A)return[];if(!(_=A.queries[w]))return[null,!1,A,null];var O=_[(x.query?x.query.index.name:null)||""];if(!O)return[null,!1,A,null];switch(w){case"query":var P=O.find(function(F){return F.req.limit===x.limit&&F.req.values===x.values&&Xr(F.req.query.range,x.query.range)});return P?[P,!0,A,O]:[O.find(function(F){return("limit"in F.req?F.req.limit:1/0)>=x.limit&&(!x.values||F.req.values)&&Xo(F.req.query.range,x.query.range)}),!1,A,O];case"count":return P=O.find(function(F){return Xr(F.req.query.range,x.query.range)}),[P,!!P,A,O]}}(t,n,"query",a),b=y[0],f=y[1],E=y[2],m=y[3];return b&&f?b.obsSet=a.obsSet:(f=r.query(a).then(function(v){var _=v.result;if(b&&(b.res=_),u){for(var w=0,x=_.length;w<x;++w)Object.freeze(_[w]);Object.freeze(_)}else v.result=De(_);return v}).catch(function(v){return m&&b&&We(m,b),Promise.reject(v)}),b={obsSet:a.obsSet,promise:f,subscribers:new Set,type:"query",req:a,dirty:!1},m?m.push(b):(m=[b],(E=E||(ht["idb://".concat(t,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[a.query.index.name||""]=m)),$o(b,m,l,h),b.promise.then(function(v){return{result:Yr(v.result,a,E?.optimisticOps,r,b,u)}})}})}})}};function vn(e,t){return new Proxy(e,{get:function(n,r,o){return r==="db"?t:Reflect.get(n,r,o)}})}var Xe=(Te.prototype.version=function(e){if(isNaN(e)||e<.1)throw new S.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new S.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter(function(r){return r._cfg.version===e})[0];return n||(n=new this.Version(e),t.push(n),t.sort(Ko),n.stores({}),this._state.autoSchema=!1,n)},Te.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||X.letThrough||this._vip)?e():new U(function(n,r){if(t._state.openComplete)return r(new S.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void r(new S.DatabaseClosed);t.open().catch(H)}t._state.dbReadyPromise.then(n,r)}).then(e)},Te.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,o=e.name;return o&&this.unuse({stack:t,name:o}),e=this._middlewares[t]||(this._middlewares[t]=[]),e.push({stack:t,create:n,level:r??10,name:o}),e.sort(function(a,u){return a.level-u.level}),this},Te.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(o){return r?o.create!==r:!!n&&o.name!==n})),this},Te.prototype.open=function(){var e=this;return ft(Qe,function(){return Uo(e)})},Te.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var e=this._state,t=Tt.indexOf(this);if(0<=t&&Tt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new U(function(n){e.dbReadyResolve=n}),e.openCanceller=new U(function(n,r){e.cancelOpen=r}))},Te.prototype.close=function(n){var t=(n===void 0?{disableAutoOpen:!0}:n).disableAutoOpen,n=this._state;t?(n.isBeingOpened&&n.cancelOpen(new S.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new S.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},Te.prototype.delete=function(e){var t=this;e===void 0&&(e={disableAutoOpen:!0});var n=0<arguments.length&&typeof arguments[0]!="object",r=this._state;return new U(function(o,a){function u(){t.close(e);var l=t._deps.indexedDB.deleteDatabase(t.name);l.onsuccess=ge(function(){var h,y,b;h=t._deps,y=t.name,b=h.indexedDB,h=h.IDBKeyRange,zn(b)||y===tn||$n(b,h).delete(y).catch(H),o()}),l.onerror=Ve(a),l.onblocked=t._fireOnBlocked}if(n)throw new S.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(u):u()})},Te.prototype.backendDB=function(){return this.idbdb},Te.prototype.isOpen=function(){return this.idbdb!==null},Te.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},Te.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Te.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Te.prototype,"tables",{get:function(){var e=this;return B(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),Te.prototype.transaction=function(){var e=(function(t,n,r){var o=arguments.length;if(o<2)throw new S.InvalidArgument("Too few arguments");for(var a=new Array(o-1);--o;)a[o-1]=arguments[o];return r=a.pop(),[t,at(a),r]}).apply(this,arguments);return this._transaction.apply(this,e)},Te.prototype._transaction=function(e,t,n){var r=this,o=X.trans;o&&o.db===this&&e.indexOf("!")===-1||(o=null);var a,u,l=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(u=t.map(function(y){if(y=y instanceof r.Table?y.name:y,typeof y!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return y}),e=="r"||e===Mn)a=Mn;else{if(e!="rw"&&e!=Kn)throw new S.InvalidArgument("Invalid transaction mode: "+e);a=Kn}if(o){if(o.mode===Mn&&a===Kn){if(!l)throw new S.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o=null}o&&u.forEach(function(y){if(o&&o.storeNames.indexOf(y)===-1){if(!l)throw new S.SubTransaction("Table "+y+" not included in parent transaction.");o=null}}),l&&o&&!o.active&&(o=null)}}catch(y){return o?o._promise(null,function(b,f){f(y)}):Ee(y)}var h=(function y(b,f,E,m,v){return U.resolve().then(function(){var _=X.transless||X,w=b._createTransaction(f,E,b._dbSchema,m);if(w.explicit=!0,_={trans:w,transless:_},m)w.idbtrans=m.idbtrans;else try{w.create(),w.idbtrans._explicit=!0,b._state.PR1398_maxLoop=3}catch(O){return O.name===s.InvalidState&&b.isOpen()&&0<--b._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),b.close({disableAutoOpen:!1}),b.open().then(function(){return y(b,f,E,null,v)})):Ee(O)}var x,A=qe(v);return A&&Et(),_=U.follow(function(){var O;(x=v.call(w,w))&&(A?(O=Ze.bind(null,null),x.then(O,O)):typeof x.next=="function"&&typeof x.throw=="function"&&(x=nr(x)))},_),(x&&typeof x.then=="function"?U.resolve(x).then(function(O){return w.active?O:Ee(new S.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):_.then(function(){return x})).then(function(O){return m&&w._resolve(),w._completion.then(function(){return O})}).catch(function(O){return w._reject(O),Ee(O)})})}).bind(null,this,a,u,o,n);return o?o._promise(a,h,"lock"):X.trans?ft(X.transless,function(){return r._whenReady(h)}):this._whenReady(h)},Te.prototype.table=function(e){if(!G(this._allTables,e))throw new S.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},Te);function Te(e,t){var n=this;this._middlewares={},this.verno=0;var r=Te.dependencies;this._options=t=d({addons:Te.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},r=t.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var o,a,u,l,h,y={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:H,dbReadyPromise:null,cancelOpen:H,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen};y.dbReadyPromise=new U(function(f){y.dbReadyResolve=f}),y.openCanceller=new U(function(f,E){y.cancelOpen=E}),this._state=y,this.name=e,this.on=Bt(this,"populate","blocked","versionchange","close",{ready:[bt,H]}),this.once=function(f,E){var m=function(){for(var v=[],_=0;_<arguments.length;_++)v[_]=arguments[_];n.on(f).unsubscribe(m),E.apply(n,v)};return n.on(f,m)},this.on.ready.subscribe=z(this.on.ready.subscribe,function(f){return function(E,m){Te.vip(function(){var v,_=n._state;_.openComplete?(_.dbOpenError||U.resolve().then(E),m&&f(E)):_.onReadyBeingFired?(_.onReadyBeingFired.push(E),m&&f(E)):(f(E),v=n,m||f(function w(){v.on.ready.unsubscribe(E),v.on.ready.unsubscribe(w)}))})}}),this.Collection=(o=this,Rt(Co.prototype,function(x,w){this.db=o;var m=Tr,v=null;if(w)try{m=w()}catch(A){v=A}var _=x._ctx,w=_.table,x=w.hook.reading.fire;this._ctx={table:w,index:_.index,isPrimKey:!_.index||w.schema.primKey.keyPath&&_.index===w.schema.primKey.name,range:m,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:v,or:_.or,valueMapper:x!==ye?x:null}})),this.Table=(a=this,Rt(Ar.prototype,function(f,E,m){this.db=a,this._tx=m,this.name=f,this.schema=E,this.hook=a._allTables[f]?a._allTables[f].hook:Bt(null,{creating:[He,H],reading:[Pe,ye],updating:[je,H],deleting:[xe,H]})})),this.Transaction=(u=this,Rt(Fo.prototype,function(f,E,m,v,_){var w=this;f!=="readonly"&&E.forEach(function(x){x=(x=m[x])===null||x===void 0?void 0:x.yProps,x&&(E=E.concat(x.map(function(A){return A.updatesTable})))}),this.db=u,this.mode=f,this.storeNames=E,this.schema=m,this.chromeTransactionDurability=v,this.idbtrans=null,this.on=Bt(this,"complete","error","abort"),this.parent=_||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new U(function(x,A){w._resolve=x,w._reject=A}),this._completion.then(function(){w.active=!1,w.on.complete.fire()},function(x){var A=w.active;return w.active=!1,w.on.error.fire(x),w.parent?w.parent._reject(x):A&&w.idbtrans&&w.idbtrans.abort(),Ee(x)})})),this.Version=(l=this,Rt(Lo.prototype,function(f){this.db=l,this._cfg={version:f,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(h=this,Rt(Dr.prototype,function(f,E,m){if(this.db=h,this._ctx={table:f,index:E===":id"?null:E,or:m},this._cmp=this._ascending=ie,this._descending=function(v,_){return ie(_,v)},this._max=function(v,_){return 0<ie(v,_)?v:_},this._min=function(v,_){return ie(v,_)<0?v:_},this._IDBKeyRange=h._deps.IDBKeyRange,!this._IDBKeyRange)throw new S.MissingAPI})),this.on("versionchange",function(f){0<f.newVersion?console.warn("Another connection wants to upgrade database '".concat(n.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(n.name,"'. Closing db now to resume the delete request.")),n.close({disableAutoOpen:!1})}),this.on("blocked",function(f){!f.newVersion||f.newVersion<f.oldVersion?console.warn("Dexie.delete('".concat(n.name,"') was blocked")):console.warn("Upgrade '".concat(n.name,"' blocked by other connection holding version ").concat(f.oldVersion/10))}),this._maxKey=jt(t.IDBKeyRange),this._createTransaction=function(f,E,m,v){return new n.Transaction(f,E,m,n._options.chromeTransactionDurability,v)},this._fireOnBlocked=function(f){n.on("blocked").fire(f),Tt.filter(function(E){return E.name===n.name&&E!==n&&!E._state.vcFired}).map(function(E){return E.on("versionchange").fire(f)})},this.use(Wo),this.use(zo),this.use(Yo),this.use(Vo),this.use(Go);var b=new Proxy(this,{get:function(f,E,m){if(E==="_vip")return!0;if(E==="table")return function(_){return vn(n.table(_),b)};var v=Reflect.get(f,E,m);return v instanceof Ar?vn(v,b):E==="tables"?v.map(function(_){return vn(_,b)}):E==="_createTransaction"?function(){return vn(v.apply(this,arguments),b)}:v}});this.vip=b,r.forEach(function(f){return f(n)})}var gn,Ke=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Ho=(ir.prototype.subscribe=function(e,t,n){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:n})},ir.prototype[Ke]=function(){return this},ir);function ir(e){this._subscribe=e}try{gn={indexedDB:k.indexedDB||k.mozIndexedDB||k.webkitIndexedDB||k.msIndexedDB,IDBKeyRange:k.IDBKeyRange||k.webkitIDBKeyRange}}catch{gn={indexedDB:null,IDBKeyRange:null}}function $r(e){var t,n=!1,r=new Ho(function(o){var a=qe(e),u,l=!1,h={},y={},b={get closed(){return l},unsubscribe:function(){l||(l=!0,u&&u.abort(),f&&nt.storagemutated.unsubscribe(m))}};o.start&&o.start(b);var f=!1,E=function(){return Rn(v)},m=function(_){hn(h,_),Jn(y,h)&&E()},v=function(){var _,w,x;!l&&gn.indexedDB&&(h={},_={},u&&u.abort(),u=new AbortController,x=function(A){var O=wt();try{a&&Et();var P=Je(e,A);return P=a?P.finally(Ze):P}finally{O&&_t()}}(w={subscr:_,signal:u.signal,requery:E,querier:e,trans:null}),Promise.resolve(x).then(function(A){n=!0,t=A,l||w.signal.aborted||(h={},function(O){for(var P in O)if(G(O,P))return;return 1}(y=_)||f||(nt(qt,m),f=!0),Rn(function(){return!l&&o.next&&o.next(A)}))},function(A){n=!1,["DatabaseClosedError","AbortError"].includes(A?.name)||l||Rn(function(){l||o.error&&o.error(A)})}))};return setTimeout(E,0),b});return r.hasValue=function(){return n},r.getValue=function(){return t},r}var mt=Xe;function sr(e){var t=rt;try{rt=!0,nt.storagemutated.fire(e),tr(e,!0)}finally{rt=t}}de(mt,d(d({},ue),{delete:function(e){return new mt(e,{addons:[]}).delete()},exists:function(e){return new mt(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return t=mt.dependencies,n=t.indexedDB,t=t.IDBKeyRange,(zn(n)?Promise.resolve(n.databases()).then(function(r){return r.map(function(o){return o.name}).filter(function(o){return o!==tn})}):$n(n,t).toCollection().primaryKeys()).then(e)}catch{return Ee(new S.MissingAPI)}var t,n},defineClass:function(){return function(e){Y(this,e)}},ignoreTransaction:function(e){return X.trans?ft(X.transless,e):e()},vip:Hn,async:function(e){return function(){try{var t=nr(e.apply(this,arguments));return t&&typeof t.then=="function"?t:U.resolve(t)}catch(n){return Ee(n)}}},spawn:function(e,t,n){try{var r=nr(e.apply(n,t||[]));return r&&typeof r.then=="function"?r:U.resolve(r)}catch(o){return Ee(o)}},currentTransaction:{get:function(){return X.trans||null}},waitFor:function(e,t){return t=U.resolve(typeof e=="function"?mt.ignoreTransaction(e):e).timeout(t||6e4),X.trans?X.trans.waitFor(t):t},Promise:U,debug:{get:function(){return Be},set:function(e){It(e)}},derive:C,extend:Y,props:de,override:z,Events:Bt,on:nt,liveQuery:$r,extendObservabilitySet:hn,getByKeyPath:le,setByKeyPath:re,delByKeyPath:function(e,t){typeof t=="string"?re(e,t,void 0):"length"in t&&[].map.call(t,function(n){re(e,n,void 0)})},shallowClone:Oe,deepClone:De,getObjectDiff:rr,cmp:ie,asap:oe,minKey:-1/0,addons:[],connections:Tt,errnames:s,dependencies:gn,cache:ht,semVer:"4.2.0",version:"4.2.0".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)})})),mt.maxKey=jt(mt.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(nt(qt,function(e){rt||(e=new CustomEvent(Ln,{detail:e}),rt=!0,dispatchEvent(e),rt=!1)}),addEventListener(Ln,function(e){e=e.detail,rt||sr(e)}));var Gt,rt=!1,zr=function(){};return typeof BroadcastChannel<"u"&&((zr=function(){(Gt=new BroadcastChannel(Ln)).onmessage=function(e){return e.data&&sr(e.data)}})(),typeof Gt.unref=="function"&&Gt.unref(),nt(qt,function(e){rt||Gt.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Xe.disableBfCache&&e.persisted){Be&&console.debug("Dexie: handling persisted pagehide"),Gt?.close();for(var t=0,n=Tt;t<n.length;t++)n[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!Xe.disableBfCache&&e.persisted&&(Be&&console.debug("Dexie: handling persisted pageshow"),zr(),sr({all:new Ie(-1/0,[[]])}))})),U.rejectionMapper=function(e,t){return!e||e instanceof $e||e instanceof TypeError||e instanceof SyntaxError||!e.name||!T[e.name]?e:(t=new T[e.name](t||e.message,e),"stack"in e&&K(t,"stack",{get:function(){return this.inner.stack}}),t)},It(Be),d(Xe,Object.freeze({__proto__:null,Dexie:Xe,liveQuery:$r,Entity:xr,cmp:ie,PropModification:Mt,replacePrefix:function(e,t){return new Mt({replacePrefix:[e,t]})},add:function(e){return new Mt({add:e})},remove:function(e){return new Mt({remove:e})},default:Xe,RangeSet:Ie,mergeRanges:Vt,rangesOverlap:Kr}),{default:Xe}),Xe})}(dr)),dr.exports}var ui=si();const hr=_o(ui),io=Symbol.for("Dexie"),gt=globalThis[io]||(globalThis[io]=hr);if(hr.semVer!==gt.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${hr.semVer} and ${gt.semVer}`);const{liveQuery:Li,mergeRanges:Ui,rangesOverlap:Vi,RangeSet:Gi,cmp:Wi,Entity:Yi,PropModification:Xi,replacePrefix:$i,add:zi,remove:Hi,DexieYProvider:Qi}=gt;function ci(c){const p=new gt(c);return p.version(1).stores({[`${An}`]:$a}),p}async function li(c){const{databaseInstance:p,records:g}=c,d=p.table(An);await p.transaction("rw",d,()=>d.bulkAdd(g))}async function fi(c){if(await gt.exists(c))return await gt.delete(c)}const pi={useBrowserApi:!0,chunkSize:32*1024,batchSize:2e3};async function so({files:c,options:p=pi}){const g=[];if(c.length===0)throw new Error("No files provided for import.");for(const d of c){if(!di(d)){console.error(`Unsupported file type: ${d.name}`);continue}d.size===0&&console.warn(`File is empty: ${d.name}`);const I=await mi({file:d,options:p});g.push(I)}return g}function di(c){return Xa.some(p=>c.name.toLowerCase().endsWith(p))}function hi(c){return c.name.replace(/\.[^.]+$/,"")}async function mi(c){const{file:p,options:g}=c;try{const d=hi(p);await fi(d);const I=ci(d);return g.useBrowserApi&&p.size!==0&&await yi({file:p,databaseInstance:I,options:{chunkSize:g.chunkSize,batchSize:g.batchSize}}),d}catch(d){throw console.error(`Error importing file ${p.name}:`,d),d}}async function yi(c){const{file:p,databaseInstance:g,options:d}=c,I=p.stream().getReader(),k=Ha(),B=new TextDecoder,D=new Uint8Array(0);return await mr({databaseInstance:g,reader:I,sax:k,textDecoder:B,buffer:D,options:d})}async function mr(c){const{databaseInstance:p,reader:g,sax:d,textDecoder:I,buffer:k,options:B}=c,{chunkSize:D,batchSize:Y}=B,{done:$,value:ee}=await g.read();if($){if(k.length>0){const de=I.decode(k);d.parser.write(de)}return d.parser.close(),await uo({databaseInstance:p,sax:d,batchSize:0})}if(!ee)return await mr(c);let G=new Uint8Array(k.length+ee.length);for(G.set(k),G.set(ee,k.length);G.length>=D;){const de=G.slice(0,D);G=G.slice(D);const se=I.decode(de,{stream:!0});d.parser.write(se),await uo({databaseInstance:p,sax:d,batchSize:Y})}return await mr({...c,buffer:G})}async function uo(c){const{databaseInstance:p,sax:g,batchSize:d}=c;if(g.getSize()>=d){const I=g.drainBatch(),k=Ga({currentBatch:I});await li({databaseInstance:p,records:k})}}const vi="_temp-idb-id";async function gi(c){return bi({databaseName:c.databaseName,withDatabaseIds:!1})}async function bi(c){const{databaseName:p,withDatabaseIds:g}=c,d=new gt(p);await d.open();const I=await wi({databaseInstance:d,withDatabaseIds:g});if(!I)throw new Error("Failed to rebuild XML document from IndexedDB.");return{xmlDocument:I,filename:d.name+".scd"}}async function wi(c){const{databaseInstance:p,withDatabaseIds:g}=c;{const d=document.implementation.createDocument("http://www.iec.ch/61850/2003/SCL",null,null),I=await p.table(An).where({tagName:"SCL"}).first();if(!I)throw new Error("No SCL root element found in DB");const k=d.createElementNS(I.namespace.uri,I.tagName);return k.setAttribute("xmlns",I.namespace.uri),I.attributes&&xo({document:d,element:k,attributes:I.attributes,isRoot:!0}),I.value&&(k.textContent=I.value.trim()),d.appendChild(k),await To({databaseInstance:p,withDatabaseIds:g,xmlDocument:d,databaseRecord:I,parentDomElement:k})}}async function To(c){const{databaseInstance:p,withDatabaseIds:g,xmlDocument:d,databaseRecord:I,parentDomElement:k}=c;if(!I.children)return;const B=I.children.map(Y=>Y.id),D=await p.table(An).bulkGet(B);for(const Y of D){if(!Y)continue;const $=_i({document:d,record:Y,withDatabaseIds:g});k.appendChild($),await To({databaseInstance:p,withDatabaseIds:g,xmlDocument:d,databaseRecord:Y,parentDomElement:$})}return c.xmlDocument}function _i(c){const{document:p,record:g,withDatabaseIds:d}=c;let I;return g.namespace.uri===Eo.default.uri?I=p.createElementNS(g.namespace.uri,g.tagName):I=p.createElementNS(g.namespace.uri,`${g.namespace.prefix}:${g.tagName}`),g.attributes&&xo({document:p,element:I,attributes:g.attributes,isRoot:!1}),g.value&&(I.textContent=g.value.trim()),d&&I.setAttribute(vi,g.id),I}function xo(c){const{document:p,element:g,attributes:d,isRoot:I}=c;for(const k of d)k.name!=="xmlns"&&(za(k)?(I||Ei({document:p,namespace:k.namespace}),g.setAttributeNS(k.namespace.uri,k.name,String(k.value))):g.setAttribute(k.name,String(k.value)))}function Ei(c){const{document:p,namespace:g}=c,d=p.documentElement;d&&(d.getAttribute(`xmlns:${g.prefix}`)!==null||d.setAttribute(`xmlns:${g.prefix}`,g.uri))}var En={exports:{}},lr={exports:{}},co;function Ti(){return co||(co=1,function(c,p){Object.defineProperty(p,"__esModule",{value:!0}),p.ParsingError=void 0;class g extends Error{constructor(W,oe){super(W),this.cause=oe}}p.ParsingError=g;let d;function I(){return Y(!1)||de()||G()||ee()||D(!1)}function k(){return C(/\s*/),Y(!0)||G()||$()||D(!1)}function B(){const z=D(!0),W=[];let oe,le=k();for(;le;){if(le.node.type==="Element"){if(oe)throw new Error("Found multiple root nodes");oe=le.node}le.excluded||W.push(le.node),le=k()}if(!oe)throw new g("Failed to parse XML","Root Element not found");if(d.xml.length!==0)throw new g("Failed to parse XML","Not Well-Formed XML");return{declaration:z?z.node:null,root:oe,children:W}}function D(z){const W=C(z?/^<\?(xml(-stylesheet)?)\s*/:/^<\?([\w-:.]+)\s*/);if(!W)return;const oe={name:W[1],type:"ProcessingInstruction",attributes:{}};for(;!(Q()||ne("?>"));){const le=se();if(le)oe.attributes[le.name]=le.value;else return}return C(/\?>/),{excluded:z?!1:d.options.filter(oe)===!1,node:oe}}function Y(z){const W=C(/^<([^?!</>\s]+)\s*/);if(!W)return;const oe={type:"Element",name:W[1],attributes:{},children:[]},le=z?!1:d.options.filter(oe)===!1;for(;!(Q()||ne(">")||ne("?>")||ne("/>"));){const Oe=se();if(Oe)oe.attributes[Oe.name]=Oe.value;else return}if(C(/^\s*\/>/))return oe.children=null,{excluded:le,node:oe};C(/\??>/);let re=I();for(;re;)re.excluded||oe.children.push(re.node),re=I();if(d.options.strictMode){const Oe=`</${oe.name}>`;if(d.xml.startsWith(Oe))d.xml=d.xml.slice(Oe.length);else throw new g("Failed to parse XML",`Closing tag not matching "${Oe}"`)}else C(/^<\/[\w-:.\u00C0-\u00FF]+\s*>/);return{excluded:le,node:oe}}function $(){const z=C(/^<!DOCTYPE\s+\S+\s+SYSTEM[^>]*>/)||C(/^<!DOCTYPE\s+\S+\s+PUBLIC[^>]*>/)||C(/^<!DOCTYPE\s+\S+\s*\[[^\]]*]>/)||C(/^<!DOCTYPE\s+\S+\s*>/);if(z){const W={type:"DocumentType",content:z[0]};return{excluded:d.options.filter(W)===!1,node:W}}}function ee(){if(d.xml.startsWith("<![CDATA[")){const z=d.xml.indexOf("]]>");if(z>-1){const W=z+3,oe={type:"CDATA",content:d.xml.substring(0,W)};return d.xml=d.xml.slice(W),{excluded:d.options.filter(oe)===!1,node:oe}}}}function G(){const z=C(/^<!--[\s\S]*?-->/);if(z){const W={type:"Comment",content:z[0]};return{excluded:d.options.filter(W)===!1,node:W}}}function de(){const z=C(/^([^<]+)/);if(z){const W={type:"Text",content:z[1]};return{excluded:d.options.filter(W)===!1,node:W}}}function se(){const z=C(/([^=]+)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)\s*/);if(z)return{name:z[1].trim(),value:K(z[2].trim())}}function K(z){return z.replace(/^['"]|['"]$/g,"")}function C(z){const W=d.xml.match(z);if(W)return d.xml=d.xml.slice(W[0].length),W}function Q(){return d.xml.length===0}function ne(z){return d.xml.indexOf(z)===0}function _e(z,W={}){z=z.trim();const oe=W.filter||(()=>!0);return d={xml:z,options:Object.assign(Object.assign({},W),{filter:oe,strictMode:W.strictMode===!0})},B()}c.exports=_e,p.default=_e}(lr,lr.exports)),lr.exports}var lo=En.exports,fo;function xi(){return fo||(fo=1,function(c,p){var g=lo&&lo.__importDefault||function(K){return K&&K.__esModule?K:{default:K}};Object.defineProperty(p,"__esModule",{value:!0});const d=g(Ti());function I(K){if(!K.options.indentation&&!K.options.lineSeparator)return;K.content+=K.options.lineSeparator;let C;for(C=0;C<K.level;C++)K.content+=K.options.indentation}function k(K){K.content=K.content.replace(/ +$/,"");let C;for(C=0;C<K.level;C++)K.content+=K.options.indentation}function B(K,C){K.content+=C}function D(K,C,Q){if(typeof K.content=="string")Y(K.content,C,Q);else if(K.type==="Element")ee(K,C,Q);else if(K.type==="ProcessingInstruction")de(K,C);else throw new Error("Unknown node type: "+K.type)}function Y(K,C,Q){if(!Q){const ne=K.trim();(C.options.lineSeparator||ne.length===0)&&(K=ne)}K.length>0&&(!Q&&C.content.length>0&&I(C),B(C,K))}function $(K,C){const Q="/"+K.join("/"),ne=K[K.length-1];return C.includes(ne)||C.includes(Q)}function ee(K,C,Q){if(C.path.push(K.name),!Q&&C.content.length>0&&I(C),B(C,"<"+K.name),G(C,K.attributes),K.children===null||C.options.forceSelfClosingEmptyTag&&K.children.length===0){const ne=C.options.whiteSpaceAtEndOfSelfclosingTag?" />":"/>";B(C,ne)}else if(K.children.length===0)B(C,"></"+K.name+">");else{const ne=K.children;B(C,">"),C.level++;let _e=K.attributes["xml:space"]==="preserve"||Q,z=!1;if(!_e&&C.options.ignoredPaths&&(z=$(C.path,C.options.ignoredPaths),_e=z),!_e&&C.options.collapseContent){let W=!1,oe=!1,le=!1;ne.forEach(function(re,Oe){re.type==="Text"?(re.content.includes(`
`)?(oe=!0,re.content=re.content.trim()):(Oe===0||Oe===ne.length-1)&&!Q&&re.content.trim().length===0&&(re.content=""),(re.content.trim().length>0||ne.length===1)&&(W=!0)):re.type==="CDATA"?W=!0:le=!0}),W&&(!le||!oe)&&(_e=!0)}ne.forEach(function(W){D(W,C,Q||_e)}),C.level--,!Q&&!_e&&I(C),z&&k(C),B(C,"</"+K.name+">")}C.path.pop()}function G(K,C){Object.keys(C).forEach(function(Q){const ne=C[Q].replace(/"/g,"&quot;");B(K," "+Q+'="'+ne+'"')})}function de(K,C){C.content.length>0&&I(C),B(C,"<?"+K.name),G(C,K.attributes),B(C,"?>")}function se(K,C={}){C.indentation="indentation"in C?C.indentation:"    ",C.collapseContent=C.collapseContent===!0,C.lineSeparator="lineSeparator"in C?C.lineSeparator:`\r
`,C.whiteSpaceAtEndOfSelfclosingTag=C.whiteSpaceAtEndOfSelfclosingTag===!0,C.throwOnFailure=C.throwOnFailure!==!1;try{const Q=(0,d.default)(K,{filter:C.filter,strictMode:C.strictMode}),ne={content:"",level:0,options:C,path:[]};return Q.declaration&&de(Q.declaration,ne),Q.children.forEach(function(_e){D(_e,ne,!1)}),C.lineSeparator?ne.content.replace(/\r\n/g,`
`).replace(/\n/g,C.lineSeparator):ne.content}catch(Q){if(C.throwOnFailure)throw Q;return K}}se.minify=(K,C={})=>se(K,Object.assign(Object.assign({},C),{indentation:"",lineSeparator:""})),c.exports=se,p.default=se}(En,En.exports)),En.exports}var Si=xi();const Ni=_o(Si);function Ai(c){return Ni(c)}const Oi=xn("file",()=>{const c=eo("currentActiveFileDatabaseName","",localStorage),p=eo("currentImportedDatabaseNames",[],localStorage);async function g(){const{promise:k,resolve:B}=Promise.withResolvers(),{open:D,onChange:Y}=to({accept:"asd"});return Y(async $=>{if(!$||$.length===0)return;const ee=Array.from($),G=[];for(const se of ee){const K=se.name.replace(/\.[^.]+$/,"");(await(indexedDB.databases?.()||[])).some(ne=>ne.name===K)&&!window.confirm(`A file named "${K}" already exists in the database. Do you want to replace it?`)||G.push(se)}if(G.length===0){B();return}const de=await so({files:G});c.value=de[0],de.length&&console.info(`Files imported successfully: ${de.join(", ")}`),B()}),D(),k}async function d(){try{if(!c.value)throw new Error("No active file to save - please open a file first");const k=await gi({databaseName:c.value}),$=`<?xml version="1.0" encoding="UTF-8"?>
`+new XMLSerializer().serializeToString(k.xmlDocument),ee=Ai($),G=new Blob([ee],{type:"application/xml"}),de=Ra(G);if(!de.value)throw new Error("Failed to create object URL for the XML document");const se=document.createElement("a");se.href=de.value,se.download=k.filename,document.body.appendChild(se),se.click(),setTimeout(()=>{document.body.removeChild(se)},0)}catch(k){throw console.error("Error saving file:",k),k}}async function I(){const{promise:k,resolve:B}=Promise.withResolvers(),{open:D,onChange:Y}=to({accept:"fsd"});return Y(async $=>{if(!$||$.length===0)return;const ee=Array.from($),G=await so({files:ee});p.value=[...p.value,...G],B()}),D(),k}return{currentActiveFileDatabaseName:c,currentImportedDatabaseNames:p,openFiles:g,saveFile:d,importFiles:I}});let fr;function Pi(){return fr||(fr=Ii()),fr}function Ii(){return{activeFileName:Ci()}}function Ci(){let c=[],p;const g=Oi();return At(()=>g.currentActiveFileDatabaseName,I),p=g.currentActiveFileDatabaseName,{get value(){return p},subscribe:d};function d(k){return c.push(k),function(){c=c.filter(D=>D!==k)}}function I(k){for(const B of c)B(k,p);p=k}}const ki={class:"root",name:"widget-site"},Di=["id"],Fi=aa({__name:"widget-site",props:{widget:{},rootId:{}},setup(c){const p=c,g=Nn();let d=Pi();const I=ia("widget-root");ho(async()=>{if(p.widget?.startFnUrl){const B=await fetch(p.widget.startFnUrl,{method:"HEAD"});k(B.url)}});async function k(B){if(!B){console.info({msg:"no startFnUrl yet"});return}const D=await ya(B);if(D){if(!I.value){console.error({msg:"could not find widget root",widgetRoot:I});return}I.value.innerHTML="",g.unmountExtension=D(p.rootId,d)}}return(B,D)=>(ca(),sa("div",ki,[ua("div",{class:"widget-root",ref:"widget-root",id:p.rootId},"Â ",8,Di)]))}}),Ji=fa(Fi,[["__scopeId","data-v-8a95d9d6"]]);function Zi(c,p){const g=So(p);g.value=c}function es(c,p){const g=So(c);At(()=>g.value,d=>{d&&p(d)},{immediate:!0})}function So(c){const p=c;return p.widgetPortal||(p.widgetPortal=la({value:void 0})),p.widgetPortal}export{Ji as W,fa as _,Nn as a,Mi as b,Oi as c,Ki as d,ji as e,es as f,qi as l,Zi as s,Ri as u};
